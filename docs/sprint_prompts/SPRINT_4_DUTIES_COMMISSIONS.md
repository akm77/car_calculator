# –ü–†–û–ú–ü–¢: –°–ü–†–ò–ù–¢ 4 ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—à–ª–∏–Ω –∏ –∫–æ–º–∏—Å—Å–∏–π

## üé≠ –†–û–õ–¨ –ú–û–î–ï–õ–ò
–¢—ã ‚Äî **Backend Configuration Engineer** —Å —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π –≤ YAML-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∞—Å—á—ë—Ç–∞—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

---

## üìò –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø
–ò—Å–ø–æ–ª—å–∑—É–π **Repository Planning Graph (RPG)** ‚Äî –ø—Ä–æ—á—Ç–∏ `docs/rpg_intro.txt`.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–ª—è —ç—Ç–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞:**
1. **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** ‚Äî –Ω–µ –ª–æ–º–∞–π —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É duties.yml
2. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–π –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ñ–∏–≥–æ–≤
3. **–¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫** ‚Äî —Å–Ω–∞—á–∞–ª–∞ duties, –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ engine.py

---

## üìä –ì–†–ê–§ –ü–†–û–ï–ö–¢–ê
**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏** –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ø—Ä–∏–Ω—Ç–∞: `docs/rpg.yaml`

**–î–æ–±–∞–≤—å –≤ recent_changes:**
```yaml
- date: "2025-12-08"
  description: "SPRINT 4 –∑–∞–≤–µ—Ä—à—ë–Ω: –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—à–ª–∏–Ω—ã lt3 –ø–æ–¥ –Ω–æ–≤—ã–µ –±—Ä—ç–∫–µ—Ç—ã RUB (325k-6500k), –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ _compute_duty(), –≤–∞–ª–∏–¥–∞—Ü–∏—è ConfigRegistry.load –ø—Ä–æ—Ö–æ–¥–∏—Ç"
```

---

## üéØ –¶–ï–õ–¨ –°–ü–†–ò–ù–¢–ê
–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ—à–ª–∏–Ω –∏ –∫–æ–º–∏—Å—Å–∏–π —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é 2025 –≥–æ–¥–∞:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏—Ç—å –±—Ä—ç–∫–µ—Ç—ã –ø–æ—à–ª–∏–Ω –¥–ª—è lt3
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–º–∏—Å—Å–∏–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (1000 USD + –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –û–ê–≠)
3. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç—ã

---

## üìö –ò–°–¢–û–ß–ù–ò–ö–ò –ü–†–ê–í–î–´

### –ü–µ—Ä–≤–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (—á–∏—Ç–∞–π –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ**: `docs/SPECIFICATION.md` (—Ä–∞–∑–¥–µ–ª "–ü–æ—à–ª–∏–Ω—ã")
2. **–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å**: `docs/REFACTORING_PROGRESS.md` (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≠—Ç–∞–ø–∞ 4)
3. **–ü–ª–∞–Ω —Ä–∞–±–æ—Ç**: `docs/REFACTORING_PLAN.md` (–≠—Ç–∞–ø 4, –∑–∞–¥–∞—á–∏ 4.1-4.3)

### –í—Ç–æ—Ä–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—à–ª–∏–Ω**: `config/duties.yml`
5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–∏—Å—Å–∏–π**: `config/commissions.yml` (—É–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω –≤ –°–ø—Ä–∏–Ω—Ç–µ 3)
6. **–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞**: `app/calculation/engine.py` (—Ñ—É–Ω–∫—Ü–∏—è `_compute_duty`)
7. **–ì—Ä–∞—Ñ –ø—Ä–æ–µ–∫—Ç–∞**: `docs/rpg.yaml`

### –ü—Ä–æ–±–ª–µ–º–∞ ¬´Lost in the Middle¬ª
‚ö†Ô∏è **–ß–∏—Ç–∞–π —Ñ–∞–π–ª—ã –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û**:
- –°–Ω–∞—á–∞–ª–∞ SPECIFICATION.md ‚Üí –Ω–∞–π–¥–∏ —Ç–∞–±–ª–∏—Ü—É –ø–æ—à–ª–∏–Ω lt3
- –ó–∞—Ç–µ–º duties.yml ‚Üí —Å—Ä–∞–≤–Ω–∏ —Å –¢–ó
- –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –î–û–°–¢–ò–ñ–ï–ù–ò–Ø –¶–ï–õ–ò

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ (Must Have)
- [ ] **duties.yml –∞–∫—Ç—É–∞–ª–µ–Ω** ‚Äî –±—Ä—ç–∫–µ—Ç—ã lt3 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¢–ó (325k, 650k, 1625k, 3250k, 6500k RUB)
- [ ] **ConfigRegistry –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** ‚Äî `python -c "from app.core.settings import get_configs; get_configs()"` –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] **–õ–æ–≥–∏–∫–∞ _compute_duty —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî manual test —Å lt3 –∞–≤—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–æ—à–ª–∏–Ω—É
- [ ] **commissions.yml –ø—Ä–æ–≤–µ—Ä–µ–Ω** ‚Äî default_commission_usd=1000, UAE exception=0

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ (Should Have)
- [ ] **–°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø** ‚Äî `config/duties.yml.backup_20251208` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- [ ] **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ** ‚Äî –ø—Ä–∏ –≤—ã–±–æ—Ä–µ duty bracket –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ª–æ–≥
- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞** ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ YAML –æ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –±—Ä—ç–∫–µ—Ç–æ–≤

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (Nice to Have)
- [ ] **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç _compute_duty** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä—ç–∫–µ—Ç–∞ lt3
- [ ] **–í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç–∏ –±—Ä—ç–∫–µ—Ç–æ–≤

---

## üîç –ó–ê–î–ê–ß–ò (–≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

### –ó–∞–¥–∞—á–∞ 4.1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ duties.yml

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ—á–∏—Ç–∞–π `config/duties.yml` ‚Äî —Å–µ–∫—Ü–∏—è `age_categories.lt3.value_brackets`
2. –°—Ä–∞–≤–Ω–∏ —Å –¢–ó (`docs/SPECIFICATION.md`, —Ç–∞–±–ª–∏—Ü–∞ "–¢–∞–º–æ–∂–µ–Ω–Ω–∞—è –ø–æ—à–ª–∏–Ω–∞ –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–∞ ‚â§3 –ª–µ—Ç")
3. –û–ø—Ä–µ–¥–µ–ª–∏ —Ä–∞–∑–ª–∏—á–∏—è:
   - –¢–µ–∫—É—â–∏–µ –±—Ä—ç–∫–µ—Ç—ã –≤ EUR –∏–ª–∏ RUB?
   - –°–æ–≤–ø–∞–¥–∞—é—Ç –ª–∏ –ø–æ—Ä–æ–≥–∏ (325k, 650k, 1625k, 3250k, 6500k)?
   - –ê–∫—Ç—É–∞–ª—å–Ω—ã –ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏ min_rate_eur_per_cc?

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –°–æ—Å—Ç–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

### –ó–∞–¥–∞—á–∞ 4.2: –û–±–Ω–æ–≤–∏—Ç—å duties.yml (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

**–ï—Å–ª–∏ –±—Ä—ç–∫–µ—Ç—ã –≤ EUR:**
```yaml
# –†–ï–®–ï–ù–ò–ï: –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –ø–æ –∫—É—Ä—Å—É 100 RUB/EUR
# –ü—Ä–∏–º–µ—Ä: 325000 RUB / 100 = 3250 EUR

age_categories:
  lt3:
    value_brackets:
      - max_customs_value_eur: 3250    # –±—ã–ª–æ 8500
        percent: 0.54
        min_rate_eur_per_cc: 2.5
      - max_customs_value_eur: 6500    # –±—ã–ª–æ 16700
        percent: 0.48
        min_rate_eur_per_cc: 3.5
      - max_customs_value_eur: 16250   # –Ω–æ–≤—ã–π –±—Ä—ç–∫–µ—Ç
        percent: 0.48
        min_rate_eur_per_cc: 5.5
      - max_customs_value_eur: 32500   # –Ω–æ–≤—ã–π –±—Ä—ç–∫–µ—Ç
        percent: 0.48
        min_rate_eur_per_cc: 7.5
      - max_customs_value_eur: 65000   # –Ω–æ–≤—ã–π –±—Ä—ç–∫–µ—Ç
        percent: 0.48
        min_rate_eur_per_cc: 15
      - percent: 0.48                  # > 65000 EUR
        min_rate_eur_per_cc: 20
```

**–ï—Å–ª–∏ –±—Ä—ç–∫–µ—Ç—ã –≤ RUB:**
```yaml
# –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –¢–ó
age_categories:
  lt3:
    value_brackets:
      - max_customs_value_rub: 325000
        percent: 0.54
        min_rate_eur_per_cc: 2.5
      # ...–∏ —Ç.–¥.
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** YAML –≤–∞–ª–∏–¥–µ–Ω (–ø—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ `yamllint config/duties.yml`)

---

### –ó–∞–¥–∞—á–∞ 4.3: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ñ–∏–≥–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏ Python REPL:
   ```python
   from app.core.settings import get_configs
   configs = get_configs()
   print(configs.duties["age_categories"]["lt3"]["value_brackets"])
   ```
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –±—Ä—ç–∫–µ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ö–æ–Ω—Ñ–∏–≥–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

---

### –ó–∞–¥–∞—á–∞ 4.4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å commissions.yml

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ—á–∏—Ç–∞–π `config/commissions.yml`
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç:
   ```yaml
   default_commission_usd: 1000
   
   by_country:
     uae:
       commission_usd: 0
   ```
3. –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞—Ä–∞—è (thresholds) ‚Äî –æ–±–Ω–æ–≤–∏ –ø–æ –æ–±—Ä–∞–∑—Ü—É –∏–∑ `docs/REFACTORING_PLAN.md`, –≠—Ç–∞–ø 4.2

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** commissions.yml —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞)

---

### –ó–∞–¥–∞—á–∞ 4.5: –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ _compute_duty

**–°–æ–∑–¥–∞–π manual test** (–∏–ª–∏ –æ–±–Ω–æ–≤–∏ `test_new_utilization.py`):
```python
from decimal import Decimal
from app.calculation.engine import calculate
from app.calculation.models import CalculationRequest

# –¢–µ—Å—Ç 1: lt3, —Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å 300,000 RUB (< 325k)
req = CalculationRequest(
    country="japan",
    year=2024,  # lt3
    engine_cc=1500,
    engine_power_hp=110,
    purchase_price=Decimal("2500000"),
    currency="JPY"
)
result = calculate(req)
print(f"–ü–æ—à–ª–∏–Ω–∞: {result.breakdown.duty_rub} RUB")
# –û–∂–∏–¥–∞–µ–º: max(54% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏, 2.5 EUR/cc √ó 1500)

# –¢–µ—Å—Ç 2: lt3, —Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å 500,000 RUB (325k-650k)
req2 = CalculationRequest(
    country="korea",
    year=2023,
    engine_cc=2000,
    engine_power_hp=150,
    purchase_price=Decimal("5000000"),
    currency="KRW"
)
result2 = calculate(req2)
print(f"–ü–æ—à–ª–∏–Ω–∞ (–±—Ä—ç–∫–µ—Ç 2): {result2.breakdown.duty_rub} RUB")
# –û–∂–∏–¥–∞–µ–º: max(48% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏, 3.5 EUR/cc √ó 2000)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ü–æ—à–ª–∏–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±—Ä—ç–∫–µ—Ç–æ–≤

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Manual Testing
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤
python -c "from app.core.settings import get_configs; c = get_configs(); print('Duties loaded:', len(c.duties['age_categories']))"

# 2. –ó–∞–ø—É—Å–∫ manual test
python test_new_utilization.py  # –¥–æ–±–∞–≤—å —Ç–µ—Å—Ç—ã –∏–∑ –ó–∞–¥–∞—á–∏ 4.5
```

### Expected Output
```
‚úÖ –ö–æ–Ω—Ñ–∏–≥–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: 3 –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚úÖ –ü–æ—à–ª–∏–Ω–∞ (–±—Ä—ç–∫–µ—Ç 1): ~180,000 RUB
‚úÖ –ü–æ—à–ª–∏–Ω–∞ (–±—Ä—ç–∫–µ—Ç 2): ~240,000 RUB
```

---

## üìù –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ duties.yml
–î–æ–±–∞–≤—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞:
```yaml
# –¢–∞–º–æ–∂–µ–Ω–Ω—ã–µ –ø–æ—à–ª–∏–Ω—ã (2025)
# –ò—Å—Ç–æ—á–Ω–∏–∫: docs/SPECIFICATION.md
# –û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-12-08
# –ë—Ä—ç–∫–µ—Ç—ã lt3 –≤ EUR (–ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –∏–∑ RUB –ø–æ –∫—É—Ä—Å—É 100:1)

age_categories:
  lt3:
    # –í–æ–∑—Ä–∞—Å—Ç ‚â§3 –ª–µ—Ç: 6 –±—Ä—ç–∫–µ—Ç–æ–≤ (325k-6500k+ RUB)
    value_brackets:
      # ...
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ rpg.yaml
```yaml
recent_changes:
  - date: "2025-12-08"
    description: "SPRINT 4 –∑–∞–≤–µ—Ä—à—ë–Ω: –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—à–ª–∏–Ω—ã lt3 (6 –±—Ä—ç–∫–µ—Ç–æ–≤, 325k-6500k RUB), –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ _compute_duty, commissions.yml –∞–∫—Ç—É–∞–ª–µ–Ω (1000 USD, UAE=0)"
```

---

## üö® –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞: –ë—Ä—ç–∫–µ—Ç—ã –≤ RUB, –Ω–æ engine.py –æ–∂–∏–¥–∞–µ—Ç EUR
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—é `_compute_duty` –≤ `app/calculation/engine.py`
2. –ù–∞–π–¥–∏ –∫–æ–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ customs_value –≤ EUR
3. –ï—Å–ª–∏ duties.yml –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ RUB, –∞–¥–∞–ø—Ç–∏—Ä—É–π –ª–æ–≥–∏–∫—É:
   ```python
   # OLD: max_value_eur = bracket.get("max_customs_value_eur")
   # NEW: max_value_rub = bracket.get("max_customs_value_rub")
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã –ª–æ–º–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî —Ç–µ—Å—Ç—ã –æ–∂–∏–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–µ –±—Ä—ç–∫–µ—Ç—ã
- –û–±–Ω–æ–≤–∏ `tests/test_data/cases.yml` –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —Å–ø—Ä–∏–Ω—Ç–µ (–°–ø—Ä–∏–Ω—Ç 8)
- –ü–æ–∫–∞ –æ—Ç–∫–ª—é—á–∏ –ø–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã: `@pytest.mark.skip(reason="–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—à–ª–∏–Ω, —Ñ–∏–∫—Å –≤ –°–ø—Ä–∏–Ω—Ç–µ 8")`

---

## ‚è±Ô∏è –í–†–ï–ú–Ø –í–´–ü–û–õ–ù–ï–ù–ò–Ø
**–û—Ü–µ–Ω–∫–∞:** 1-2 —á–∞—Å–∞

**Breakdown:**
- –ó–∞–¥–∞—á–∞ 4.1: 15 –º–∏–Ω—É—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞)
- –ó–∞–¥–∞—á–∞ 4.2: 30 –º–∏–Ω—É—Ç (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ YAML)
- –ó–∞–¥–∞—á–∞ 4.3: 10 –º–∏–Ω—É—Ç (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
- –ó–∞–¥–∞—á–∞ 4.4: 10 –º–∏–Ω—É—Ç (commissions check)
- –ó–∞–¥–∞—á–∞ 4.5: 30 –º–∏–Ω—É—Ç (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## üìû NEXT STEPS
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ø—Ä–∏–Ω—Ç–∞:
1. **–û–±–Ω–æ–≤–∏ rpg.yaml** (–¥–æ–±–∞–≤—å recent_changes)
2. **–ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
   ```bash
   git add config/duties.yml config/commissions.yml docs/rpg.yaml
   git commit -m "feat(config): update duties lt3 brackets to 2025 spec (325k-6500k RUB)"
   ```
3. **–ü–µ—Ä–µ—Ö–æ–¥–∏ –∫ –°–ø—Ä–∏–Ω—Ç—É 5** (API –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ) ‚Äî —Å–º. `docs/sprint_prompts/SPRINT_5_API_META.md`

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –§–ê–ô–õ–´
- `docs/SPECIFICATION.md` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- `docs/REFACTORING_PLAN.md` ‚Äî –ø–æ–ª–Ω—ã–π –ø–ª–∞–Ω (–≠—Ç–∞–ø 4)
- `docs/REFACTORING_PROGRESS.md` ‚Äî —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å
- `config/duties.yml` ‚Äî —Ü–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª
- `config/commissions.yml` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–π —Ñ–∞–π–ª
- `app/calculation/engine.py` ‚Äî –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞

---

**–ê–≤—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞:** RPG Architect  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-12-08

