rpg:
  metadata:
    project_name: "car_calculator"
    description: "FastAPI-—Å–µ—Ä–≤–∏—Å –∏ Telegram-–±–æ—Ç –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤–≤–æ–∑–∞ –∞–≤—Ç–æ –Ω–∞ –±–∞–∑–µ —Ç–∞—Ä–∏—Ñ–æ–≤, –∫–æ–º–∏—Å—Å–∏–π –∏ –≤–∞–ª—é—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ YAML + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ live CBR)."
    version: "2.0.0"
    python_version: "3.13"
    total_lines_of_code: 1990
    last_updated: "2025-12-08"
    architecture: "–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏: API, Calculation Engine, Bot, Services"
    supported_countries: ["japan", "korea", "uae", "china", "georgia"]
    recent_changes:
      - date: "2025-12-08"
        description: "SPRINT 1 SPEC COMPLETED: –§–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∞ –∫ –≤–∞–ª—é—Ç–Ω–æ–º—É –∫—É—Ä—Å—É –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (SPEC + RPG) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è bank_commission –≤ config/commissions.yml (enabled, percent, meta.recommended_min/max, warn_above, default_percent), –æ–ø–∏—Å–∞–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç effective_rate = base_rate √ó (1 + bank_commission_percent/100), –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ total_rub –∏ CalculationMeta.rates_used (base_rate, bank_commission_percent, effective_rate), —Ä–∞–∑–≤–µ–¥–µ–Ω—ã –ø–æ–Ω—è—Ç–∏—è '–∫–æ–º–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏' (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 1000 USD) –∏ '–±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è' (–ø—Ä–æ—Ü–µ–Ω—Ç –∫ –∫—É—Ä—Å—É)."
      - date: "2025-12-15"
        description: "SPRINT 3 DESIGN COMPLETED: –£—Ç–æ—á–Ω—ë–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç /api/calculate –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ JSON: breakdown.total_rub —Ç—Ä–∞–∫—Ç—É–µ—Ç—Å—è –∫–∞–∫ —Å—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö —É–∂–µ —Å —É—á—ë—Ç–æ–º –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ (—á–µ—Ä–µ–∑ effective_rate), –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –≤ JSON; –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç meta.rates_used –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ 'BASE_RATE [+ PERCENT%]' –¥–ª—è WebApp –∏ Telegram-–±–æ—Ç–∞); –æ–±–Ω–æ–≤–ª—ë–Ω RPG-–ø–æ—Ç–æ–∫ engine.calculate() ‚Üí CalculationResult(meta.rates_used) ‚Üí api.routes ‚Üí webapp/bot, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ, —á—Ç–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö –∫–æ–º–∏—Å—Å–∏—è –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∞ –∫ –∫—É—Ä—Å—É, –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —Å—É–º–º."
    planned_improvements:
      - priority: "HIGH"
        component: "app_webapp"
        description: "–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ index.html (1548 —Å—Ç—Ä–æ–∫) –Ω–∞ –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É"
        reference: "docs/webapp_refactoring_sprints.md"
        detailed_plan: "docs/webapp_refactoring_plan.md"
        estimated_time: "3-5 –¥–Ω–µ–π"
        benefits:
          - "–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å < 300 —Å—Ç—Ä–æ–∫"
          - "–í—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã: 30 –º–∏–Ω (–±—ã–ª–æ 4—á)"
          - "–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏/–∫–æ–Ω—Å—Ç–∞–Ω—Ç"
          - "–ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ CSS/JS"
        stages:
          - "CSS extraction (variables, base, components)"
          - "Utils modules (formatters, dom helpers, debounce)"
          - "Config modules (messages, constants)"
          - "Validator module (form validation logic)"
          - "API client (improved error handling, retry, timeout)"
          - "UI module (show/hide helpers)"
          - "Results renderer (display calculation results)"
          - "Calculator controller (orchestration)"
          - "Minimal index.html (structure only)"
          - "Basic unit tests (optional)"
      - priority: "HIGH"
        component: "bank_commission_runtime_support"
        description: "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ (bank_commission) –≤ –¥–≤–∏–∂–∫–µ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö."
        reference: "docs/sprints/sprint1_bank_commission_config.md"
        estimated_time: "2-3 —Å–ø—Ä–∏–Ω—Ç–∞ (design + implementation + tests)"
        stages:
          - "SPRINT 2: –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è bank_commission –≤ engine.py (–≤—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ –≤–∞–ª—é—Ç–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏, –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á—ë—Ç effective_rate)."
          - "SPRINT 3: –†–∞—Å—à–∏—Ä–∏—Ç—å CalculationMeta.rates_used (base_rate, bank_commission_percent, effective_rate) –∏ –æ–ø–∏—Å–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç –≤ API/–∫–ª–∏–µ–Ω—Ç–∞—Ö."
          - "SPRINT 4: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ bank_commission –∏–∑ config/commissions.yml, –≤–Ω–µ–¥—Ä–∏—Ç—å effective_rate –≤ —Ä–∞—Å—á—ë—Ç—ã, –¥–æ–±–∞–≤–∏—Ç—å unit- –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã."

    sprint_prompts:
      location: "docs/sprint_prompts/"
      description: "–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM-–∞—Å—Å–∏—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ø—Ä–∏–Ω—Ç–æ–≤ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (4-10)"
      methodology: "Repository Planning Graph (RPG) ‚Äî docs/rpg_intro.txt"
      problem_solved: "Lost in the Middle ‚Äî –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"
      created: "2025-12-08"
      sprints:
        - id: "SPRINT_4"
          file: "SPRINT_4_DUTIES_COMMISSIONS.md"
          title: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—à–ª–∏–Ω –∏ –∫–æ–º–∏—Å—Å–∏–π"
          time_estimate: "1-2 —á–∞—Å–∞"
          status: "COMPLETED"
          completed_date: "2025-12-08"
        - id: "SPRINT_5"
          file: "SPRINT_5_API_META.md"
          title: "API –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ"
          time_estimate: "1 —á–∞—Å"
          status: "COMPLETED"
          completed_date: "2025-12-08"
        - id: "SPRINT_6"
          file: "SPRINT_6_FRONTEND_WEBAPP.md"
          title: "–§—Ä–æ–Ω—Ç–µ–Ω–¥ (WebApp)"
          time_estimate: "3-4 —á–∞—Å–∞"
          status: "TODO"
        - id: "SPRINT_7"
          file: "SPRINT_7_TELEGRAM_BOT.md"
          title: "Telegram Bot"
          time_estimate: "1 —á–∞—Å"
          status: "TODO"
        - id: "SPRINT_8"
          file: "SPRINT_8_TESTS.md"
          title: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
          time_estimate: "3-4 —á–∞—Å–∞"
          status: "TODO"
        - id: "SPRINT_9"
          file: "SPRINT_9_DOCUMENTATION.md"
          title: "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"
          time_estimate: "1-2 —á–∞—Å–∞"
          status: "TODO"
        - id: "SPRINT_10"
          file: "SPRINT_10_FINALIZATION.md"
          title: "–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–µ–ø–ª–æ–π"
          time_estimate: "1 —á–∞—Å"
          status: "TODO"
      features:
        - "–†–æ–ª—å –º–æ–¥–µ–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞"
        - "–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–∞–≤–¥—ã (–ø–µ—Ä–≤–∏—á–Ω—ã–µ/–≤—Ç–æ—Ä–∏—á–Ω—ã–µ)"
        - "–ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ (Must/Should/Nice to Have)"
        - "–ü—Ä–æ–±–ª–µ–º–∞ Lost in the Middle —Ä–µ—à–µ–Ω–∞ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)"
        - "–¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á"
        - "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ rpg.yaml –ø–æ—Å–ª–µ —Å–ø—Ä–∏–Ω—Ç–∞"
        - "–í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç docstrings"

  nodes:
    modules:
      - name: "app_core"
        path: "app/core"
        description: "–ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è"
      - name: "app_calculation"
        path: "app/calculation"
        description: "–î–≤–∏–∂–æ–∫ —Ä–∞—Å—á—ë—Ç–∞, –º–æ–¥–µ–ª–∏, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∏ —Ç–∞—Ä–∏—Ñ–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã. –í —Ç–æ–º —á–∏—Å–ª–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∏ –∫ –≤–∞–ª—é—Ç–Ω—ã–º –∫—É—Ä—Å–∞–º (effective_rate) –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ CalculationMeta.rates_used/detailed_rates_used –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤."
      - name: "app_services"
        path: "app/services"
        description: "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–∫—É—Ä—Å—ã CBR, —Å–ª–∏—è–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö/–∂–∏–≤—ã—Ö –∫—É—Ä—Å–æ–≤)"
      - name: "app_api"
        path: "app/api"
        description: "HTTP API-–º–∞—Ä—à—Ä—É—Ç—ã FastAPI. –°–µ—Ä–∏–ª–∏–∑—É—é—Ç CalculationResult (breakdown, meta, request) –≤ JSON –∏ –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç meta.rates_used –∫–ª–∏–µ–Ω—Ç–∞–º –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏."
      - name: "app_main"
        path: "app"
        description: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI, CORS middleware, rate limiting, —Å—Ç–∞—Ç–∏–∫–∞ (/web, /static), —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å /, manifest.json, sw.js, /ping, /debug/files; lifespan –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤"
      - name: "app_bot"
        path: "app/bot"
        description: "Telegram-–±–æ—Ç (aiogram). –ü–æ–ª—É—á–∞–µ—Ç CalculationResult –æ—Ç –¥–≤–∏–∂–∫–∞ / API –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç HTML-—Å–æ–æ–±—â–µ–Ω–∏—è —Å breakdown –∏ —Å—Ç—Ä–æ–∫–æ–π –∫—É—Ä—Å–∞, –∏—Å–ø–æ–ª—å–∑—É—è —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (display –≤ CalculationMeta.detailed_rates_used). –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∞ '+ X%' –∫ –∫—É—Ä—Å—É, –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π/–∫–æ–º–∞–Ω–¥ –¥–ª—è –µ—ë –∏–∑–º–µ–Ω–µ–Ω–∏—è."
      - name: "app_webapp"
        path: "app/webapp"
        description: "–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π PWA —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞ —á–µ—Ä–µ–∑ /api/calculate –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç: breakdown (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –≤ —Ä—É–±–ª—è—Ö) –∏ —Å—Ç—Ä–æ–∫—É –∫—É—Ä—Å–∞ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî CalculationMeta.detailed_rates_used[CODE].display –≤–∏–¥–∞ 'USD/RUB = BASE [+ PERCENT%]'). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π ‚Äî –æ–Ω–∞ –∑–∞–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥–æ–º."
      - name: "app_webapp_hints"
        path: "app/webapp/css/hints.css + app/webapp/js/modules/hints.js"
        description: "–í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã (–≤–æ–∑—Ä–∞—Å—Ç, –º–æ—â–Ω–æ—Å—Ç—å) - MVP —Å–∏—Å—Ç–µ–º–∞ real-time —Ñ–∏–¥–±–µ–∫–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–≤—Ç–æ"
        components:
          - "hints.css - —Ü–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π (4 –∑–æ–Ω—ã), —Å—Ç–∏–ª–∏ –¥–ª—è tooltip –∏ hint text, –∞–Ω–∏–º–∞—Ü–∏–∏, —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞, a11y"
          - "hints.js - HintsManager –∫–ª–∞—Å—Å (getAgeHintData, getPowerHintData, applyHintToField, showHintText, initTooltips, attachFieldHints)"
          - "constants.js HINT_THRESHOLDS - –ø–æ—Ä–æ–≥–∏ –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–∞ (3-5 –ª–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ) –∏ –º–æ—â–Ω–æ—Å—Ç–∏ (160/200/300 –ª.—Å.)"
          - "messages.js hints - —Ç–µ–∫—Å—Ç—ã –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∑–æ–Ω (optimal/acceptable/warning/prohibitive)"
        features:
          - "–¶–≤–µ—Ç–æ–≤—ã–µ –∑–æ–Ω—ã: üü¢ optimal (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏), üîµ acceptable (–Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞—Å—Ç–∏), üü† warning (–≤—ã—Å–æ–∫–∏–µ), üî¥ prohibitive (–∑–∞–ø—Ä–µ—Ç–∏—Ç–µ–ª—å–Ω—ã–µ)"
          - "–ö—Ä–∞—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–¥ –ø–æ–ª—è–º–∏ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∑–æ–Ω—ã"
          - "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ ‚ÑπÔ∏è —Å tooltip'–∞–º–∏ (–ø–æ—Ä–æ–≥–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)"
          - "Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ (debounced 300ms –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)"
          - "Accessibility: ARIA attributes, keyboard support (Tab + Enter/Space), screen reader friendly"
          - "Smooth CSS transitions –º–µ–∂–¥—É —Ü–≤–µ—Ç–∞–º–∏"
          - "–ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (44x44px tap targets, responsive tooltips)"
          - "Dark mode support (prefers-color-scheme)"
          - "High contrast mode support"
        thresholds:
          age:
            optimal: "3-5 –ª–µ—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—à–ª–∏–Ω—ã)"
            prohibitive: "<3 –ª–µ—Ç (–≤—ã—Å–æ–∫–∞—è –ø–æ—à–ª–∏–Ω–∞ –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –∞–≤—Ç–æ)"
            warning: ">5 –ª–µ—Ç (–ø–æ—à–ª–∏–Ω–∞ –≤—ã—à–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π)"
          power:
            optimal: "‚â§160 –ª.—Å. (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ç–∏–ª—å—Å–±–æ—Ä 5,200‚ÇΩ)"
            acceptable: "160-200 –ª.—Å. (—É—Ç–∏–ª—å—Å–±–æ—Ä —Ä–∞—Å—Ç–µ—Ç)"
            warning: "200-300 –ª.—Å. (–≤—ã—Å–æ–∫–∏–π —É—Ç–∏–ª—å—Å–±–æ—Ä)"
            prohibitive: ">300 –ª.—Å. (–∑–∞–ø—Ä–µ—Ç–∏—Ç–µ–ª—å–Ω—ã–π, –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å —Ü–µ–Ω—É –∞–≤—Ç–æ)"
        files_changed:
          - "app/webapp/css/hints.css (NEW, 8.2K, 350+ lines)"
          - "app/webapp/js/modules/hints.js (NEW, 10K, 335 lines)"
          - "app/webapp/js/config/constants.js (MODIFIED, +23 lines)"
          - "app/webapp/js/config/messages.js (MODIFIED, +28 lines)"
          - "app/webapp/index.html (MODIFIED, +4 lines imports, +5 lines init)"
          - "tests/manual/test_hints_mvp.html (NEW, standalone test page)"
        time_spent: "2.5 —á–∞—Å–∞"
        implemented_date: "2025-12-08"
        reference_docs:
          - "docs/UI_HINTS_INTEGRATION_PROPOSAL.md (–ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è, –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)"
          - "docs/UI_HINTS_SUMMARY.md (–∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ, —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞)"
          - "docs/QUICK_REFERENCE_AGE_OPTIMAL.md (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ—Ä–æ–≥–∏ –ø–æ—à–ª–∏–Ω)"
          - "docs/QUICK_REFERENCE_POWER_LIMITS.md (–ø–æ—Ä–æ–≥–∏ –º–æ—â–Ω–æ—Å—Ç–∏, —É—Ç–∏–ª—å—Å–±–æ—Ä)"
          - "docs/SPRINT_MVP_HINTS_PROMPT.md (–ø—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ MVP)"
        structure:
          - "index.html - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, validator –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω)"
          - "index.html.backup - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (1548 —Å—Ç—Ä–æ–∫)"
          - "css/ - —Å—Ç–∏–ª–∏ (variables, base, components with validation styles, telegram)"
          - "js/config/ - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (constants.js ‚úÖ, messages.js ‚úÖ)"
          - "js/utils/ - —É—Ç–∏–ª–∏—Ç—ã (formatters.js ‚úÖ, dom.js ‚úÖ)"
          - "js/modules/ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (validator.js ‚úÖ, api.js ‚úÖ, ui.js ‚úÖ, results.js, calculator.js)"
          - "manifest.json, sw.js - PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç –∏ service worker"
          - "*.png - –∏–∫–æ–Ω–∫–∏ –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã"
        refactoring_status:
          stage: "SPRINT_6_COMPLETED"
          date: "2025-12-05"
          description: "–°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π UI –º–µ–Ω–µ–¥–∂–µ—Ä —Å state management –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏"
          components_created:
            - "js/modules/ui.js - UI –∫–ª–∞—Å—Å (state management: idle/loading/error/success, showError/showLoading/showResult/hideError/hideLoading/hideResult, showToast —Å —Ç–∏–ø–∞–º–∏, haptic feedback, accessibility ARIA, fade –∞–Ω–∏–º–∞—Ü–∏–∏)"
            - "js/modules/api.js - APIClient –∫–ª–∞—Å—Å (retry, timeout, error handling), APIError (—Ç–∏–ø–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫), —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã (calculate, getMeta, getRates, refreshRates)"
            - "js/modules/validator.js - FormValidator –∫–ª–∞—Å—Å (validate, validateField, getFieldConstraints, addCustomValidator)"
            - "js/config/messages.js - –≤—Å–µ UI —Ç–µ–∫—Å—Ç—ã (errors, buttons, labels, breakdown, warnings, share templates)"
            - "js/config/constants.js - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å models.py), API endpoints, –¥–µ—Ñ–æ–ª—Ç—ã, fallback metadata"
            - "js/utils/formatters.js - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (17 —Ñ—É–Ω–∫—Ü–∏–π)"
            - "js/utils/dom.js - DOM –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ (18 —Ñ—É–Ω–∫—Ü–∏–π)"
            - "css/components.css - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (.error, .field-error, animations)"
            - "index.html - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã FormValidator –∏ APIClient, —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å APIError.getUserMessage()"
            - "tests/manual/test_api_client.html - API test suite (8 —Ç–µ—Å—Ç–æ–≤: GET, POST, validation, network, timeout, retry, error types)"
            - "tests/manual/test_validator.html - comprehensive test suite (40+ test cases)"
          synchronization:
            - "Constraints.YEAR_MIN (1990) ‚Üî models.py @field_validator (year < 1990)"
            - "Constraints.ENGINE_CC_MIN/MAX (500-10000) ‚Üî models.py Field(gt=0)"
            - "Messages.errors ‚Üî app/core/messages.py (ERR_YEAR_FUTURE, ERR_YEAR_TOO_OLD)"
            - "FALLBACK_META.countries ‚Üî /api/meta response structure"
            - "FormValidator.validateField('year') ‚Üî CalculationRequest.year validator"
            - "FormValidator.validate() ‚Üî Backend Pydantic validation rules"
            - "APIClient.calculate() ‚Üî POST /api/calculate endpoint"
            - "APIError.getUserMessage() ‚Üî FastAPI error responses"
          next_stage: "SPRINT_6_UI_MODULE"
      - name: "config_data"
        path: "config"
        description: "YAML-–∫–æ–Ω—Ñ–∏–≥–∏ —Ç–∞—Ä–∏—Ñ–æ–≤: fees.yml, commissions.yml, rates.yml, duties.yml. –í —Ä–∞–º–∫–∞—Ö SPRINT 1 —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–µ–∫—Ü–∏—è bank_commission –≤ commissions.yml (–∫–∞–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π runtime-–∫–æ–¥–∞): –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ (enabled, percent) –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (recommended_min/max, warn_above, default_percent)."
      - name: "tests"
        path: "tests"
        description: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã API/–¥–≤–∏–∂–∫–∞ –∏ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã CBR"

    files:
      - name: "settings.py"
        parent_module: "app_core"
        description: "AppSettings (Pydantic Settings, .env), ConfigRegistry (–∑–∞–≥—Ä—É–∑–∫–∞ fees/commissions/rates/duties.yml —Å —Ö—ç—à–µ–º –∏ timestamp), @lru_cache –≥–µ—Ç—Ç–µ—Ä—ã get_settings() –∏ get_configs()"
      - name: "messages.py"
        parent_module: "app_core"
        description: "–°—Ç—Ä–æ–∫–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π/–∏–Ω—Ñ–æ"

      - name: "engine.py"
        parent_module: "app_calculation"
        description: "–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è calculate() + helpers: _compute_duty (lt3: percent+min, 3_5/gt5: rate per cc), _utilization_fee_v2 (2D —Ç–∞–±–ª–∏—Ü–∞ –æ–±—ä—ë–º+–º–æ—â–Ω–æ—Å—Ç—å –≤ –∫–í—Ç, M1 only), _commission (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 1000 USD + –ø–æ —Å—Ç—Ä–∞–Ω–∞–º, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ effective_rate –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π bank_commission), _select_freight, _japan_country_expenses (—Ç–∏–∏—Ä—ã –≤ JPY), _other_country_expenses, _convert/_convert_from_rub, _currency_rate, _effective_currency_rate, _get_bank_commission_percent; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Decimal –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏. –í–Ω—É—Ç—Ä–∏ calculate() —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è breakdown –∏ CalculationMeta, –≤–∫–ª—é—á–∞—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ meta.rates_used (—á–∏—Å–ª–æ–≤—ã–µ –∫—É—Ä—Å—ã XXX_RUB) –∏ meta.detailed_rates_used (RateUsage —Å base/effective/percent/display)."
      - name: "models.py"
        parent_module: "app_calculation"
        description: "Pydantic v2 –º–æ–¥–µ–ª–∏: CalculationRequest (–≤–∞–ª–∏–¥–∞—Ü–∏—è year 1990-current, engine_power_hp 1-1500, normalize currency), CostBreakdown (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ RUB), CalculationMeta (age_category, duty_mode, vehicle_type, engine_power_hp/kw, utilization_coefficient, warnings, rates_used: dict[str, float] –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∫—É—Ä—Å–æ–≤, detailed_rates_used: dict[str, RateUsage] –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –∫—É—Ä—Å–æ–≤ —Å base_rate/effective_rate/bank_commission_percent/display), CalculationResult; Literal —Ç–∏–ø—ã: Country ['japan', 'korea', 'uae', 'china', 'georgia'], FreightType, VehicleType; WarningItem"
      - name: "rounding.py"
        parent_module: "app_calculation"
        description: "–§—É–Ω–∫—Ü–∏–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏ Decimal-—É—Ç–∏–ª–∏—Ç—ã"
      - name: "tariff_tables.py"
        parent_module: "app_calculation"
        description: "–§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫ –ø–æ—à–ª–∏–Ω—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–π/–¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤"

      - name: "cbr.py"
        parent_module: "app_services"
        description: "CBRRatesService (thread-safe —Å Lock, CacheEntry, TTL –ø—Ä–æ–≤–µ—Ä–∫–∞), parse_cbr_xml (ET –ø–∞—Ä—Å–∏–Ω–≥ VunitRate –¥–ª—è USD/EUR/JPY/CNY/AED), _do_fetch (httpx + @retry/tenacity), get_effective_rates (—Å–ª–∏—è–Ω–∏–µ static+live), fetch_rates (force –æ–ø—Ü–∏—è, pytest guard)"

      - name: "routes.py"
        parent_module: "app_api"
        description: "APIRouter /api: GET /health (config_hash, cbr_cache, eur_rate), POST /calculate (–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic), GET /rates (currencies, commissions, utilization, duties, japan_expense_tiers, countries_active, live_source), POST /rates/refresh (force CBR), GET /meta (countries —Å labels –∏ emoji –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UI, freight_types, age_categories, constraints, currencies_supported)"

      - name: "main.py"
        parent_module: "app_main"
        description: "–°–æ–∑–¥–∞–Ω–∏–µ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, CORS, rate-limit, —Å—Ç–∞—Ç–∏–∫–∞, /, /manifest.json, /sw.js, /ping, /debug/files"
      - name: "struct_logger.py"
        parent_module: "app_main"
        description: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ structured logging (structlog), –≥–ª–æ–±–∞–ª—å–Ω—ã–π logger"

      - name: "main.py"
        parent_module: "app_bot"
        description: "_build_bot (TOKEN_PATTERN regex –≤–∞–ª–∏–¥–∞—Ü–∏—è, DefaultBotProperties(ParseMode.HTML)), _build_dispatcher (register handlers), _set_commands (BotCommand /start), main_async (setup_logging, TelegramNotFound –æ–±—Ä–∞–±–æ—Ç–∫–∞, dp.start_polling —Å allowed_updates), run_bot entrypoint; Custom exceptions: MissingBotTokenError, InvalidBotTokenError"
      - name: "handlers/start.py"
        parent_module: "app_bot"
        description: "Router: @router.message(Command('start')) ‚Üí cmd_start (–ø—Ä–æ–≤–µ—Ä–∫–∞ HTTPS –¥–ª—è WebApp button, main_menu –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞), @router.message(Command('calc')) ‚Üí cmd_calc (–ø—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ japan 2021 1496cc 110hp —Å _format_result), @router.message(F.web_app_data) ‚Üí on_webapp_data (–ø–∞—Ä—Å–∏–Ω–≥ JSON —Å engine_power_hp, –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤—ã–∑–æ–≤ calculate, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ _format_result —Å –º–æ—â–Ω–æ—Å—Ç—å—é –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —É—Ç–∏–ª—å—Å–±–æ—Ä–∞); _format_result helper (HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å breakdown, –º–æ—â–Ω–æ—Å—Ç—å—é –≤ –∫–í—Ç, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —É—Ç–∏–ª—å—Å–±–æ—Ä–∞); register(dp: Dispatcher)"
      - name: "keyboards.py"
        parent_module: "app_bot"
        description: "ReplyKeyboard —Å WebApp-–∫–Ω–æ–ø–∫–æ–π"

      - name: "messages.js"
        parent_module: "app_webapp"
        description: "Single source of truth –¥–ª—è –≤—Å–µ—Ö UI —Ç–µ–∫—Å—Ç–æ–≤: errors (–≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–µ—Ç—å, enginePowerHpRequired), buttons (labels), labels (–ø–æ–ª—è —Ñ–æ—Ä–º—ã, ENGINE_POWER_HP), breakdown (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏, ENGINE_POWER_KW, UTILIZATION_COEFFICIENT), info (toast —Å–æ–æ–±—â–µ–Ω–∏—è), warnings (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è), share (—à–∞–±–ª–æ–Ω—ã –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞), age (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤–æ–∑—Ä–∞—Å—Ç–∞), freight/vehicle/countries/currencies (fallback labels)"
      - name: "constants.js"
        parent_module: "app_webapp"
        description: "–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: Constraints (YEAR_MIN=1990, YEAR_MAX, ENGINE_CC_MIN=500, ENGINE_CC_MAX=10000, ENGINE_POWER_HP_MIN=1, ENGINE_POWER_HP_MAX=1500 - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å models.py), CONVERSION_FACTORS (HP_TO_KW=0.7355, KW_TO_HP=1.35962), API_ENDPOINTS, API_CONFIG (retry, timeout, payload limits), DEFAULT_VALUES (COUNTRY='japan', ENGINE_CC=1500, YEAR_OFFSET=3), COUNTRY_EMOJI (fruit emojis), FALLBACK_META, HAPTIC_TYPES, TOAST_CONFIG, ANIMATION, DEBOUNCE, form/result element IDs"
      - name: "validator.js"
        parent_module: "app_webapp"
        description: "–ú–æ–¥—É–ª—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º: FormValidator –∫–ª–∞—Å—Å (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–∏–ª –≤–∞–ª–∏–¥–∞—Ü–∏–∏), –º–µ—Ç–æ–¥—ã: validate(formData) ‚Üí {isValid, errors[]}, validateField(name, value) ‚Üí error|null (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ year, engine_cc, engine_power_hp, purchase_price, country), getFieldConstraints(name) ‚Üí {min, max, step, required, type}, addCustomValidator(fieldName, fn), removeCustomValidator(), clearCustomValidators; –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏; —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å backend Pydantic –º–æ–¥–µ–ª—è–º–∏"
      - name: "api.js"
        parent_module: "app_webapp"
        description: "–ú–æ–¥—É–ª—å HTTP –∫–ª–∏–µ–Ω—Ç–∞: APIClient –∫–ª–∞—Å—Å (singleton), –º–µ—Ç–æ–¥—ã: calculate/getMeta/getRates/refreshRates (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è API), _request (–±–∞–∑–æ–≤—ã–π HTTP —Å retry, timeout, payload size check), _handleError (–º–∞–ø–ø–∏–Ω–≥ HTTP —Å—Ç–∞—Ç—É—Å–æ–≤); APIError –∫–ª–∞—Å—Å (code, httpStatus, getUserMessage, toLogFormat); –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: MAX_RETRIES=3, REQUEST_TIMEOUT=10s, MAX_PAYLOAD_SIZE=10MB"
      - name: "ui.js"
        parent_module: "app_webapp"
        description: "–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏: UI –∫–ª–∞—Å—Å (singleton), state management (_state: idle/loading/error/success, getState, _setState), –º–µ—Ç–æ–¥—ã: showLoading(text)/hideLoading, showError(msg)/hideError, showResult/hideResult, showShareButton/hideShareButton, scrollToResult, disableForm/enableForm, reset, showToast(message, type, duration); –∞–Ω–∏–º–∞—Ü–∏–∏: _fadeIn/_fadeOut (CSS transitions), _hapticFeedback (Telegram); accessibility: ARIA attributes (role, aria-live, aria-busy), focus management"
      - name: "hints.js"
        parent_module: "app_webapp_hints"
        description: "–ú–æ–¥—É–ª—å –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π (MVP): HintsManager –∫–ª–∞—Å—Å (constructor(constants, messages)), –º–µ—Ç–æ–¥—ã: getAgeHintData(year) ‚Üí {zone, className, text, ariaLabel} (—Ä–∞—Å—á–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω—ã: optimal 3-5 –ª–µ—Ç, prohibitive <3, warning >5), getPowerHintData(powerHp) ‚Üí hint data (–∑–æ–Ω—ã –ø–æ –º–æ—â–Ω–æ—Å—Ç–∏: optimal ‚â§160, acceptable 160-200, warning 200-300, prohibitive >300), applyHintToField(fieldElement, hintData) (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ CSS –∫–ª–∞—Å—Å–æ–≤ –∏ ARIA –∞—Ç—Ä–∏–±—É—Ç–æ–≤), showHintText(fieldElement, text) (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–¥ –ø–æ–ª–µ–º), hideHintText(fieldElement), _createTooltip(tooltipText, iconElement) (–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º viewport), showTooltip/hideTooltip (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ tooltip'–∞–º–∏), initTooltips() (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ ‚ÑπÔ∏è –∏–∫–æ–Ω–æ–∫ –∫ labels –ø–æ–ª–µ–π year –∏ enginePowerHp), attachFieldHints(fieldElement, fieldType) (debounced input handler 300ms), init() (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è year –∏ enginePowerHp), destroy() (cleanup); activeTooltips Map –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è; debounce —É—Ç–∏–ª–∏—Ç–∞; real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, keyboard support (Enter/Space), click/hover events, auto-hide —á–µ—Ä–µ–∑ 5 —Å–µ–∫"
      - name: "hints.css"
        parent_module: "app_webapp_hints"
        description: "–°—Ç–∏–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫: —Ü–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π (.input-hint-optimal green, .input-hint-acceptable blue, .input-hint-warning orange, .input-hint-prohibitive red —Å border 2px, background rgba, transitions 0.3s, focus states —Å box-shadow), .hint-text (–ø–æ–¥ –ø–æ–ª–µ–º, font-size 13px, fadeIn animation 0.2s, —Ü–≤–µ—Ç–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã), .info-icon (‚ÑπÔ∏è inline-flex 18x18px, hover scale 1.15, :focus outline, ::after –¥–ª—è tap area 44x44px), .hint-tooltip (absolute, max-width 280px, padding 10px, border-radius 8px, box-shadow, ::before —Å—Ç—Ä–µ–ª–∫–∞, .tooltip-bottom/.tooltip-top –ø–æ–∑–∏—Ü–∏–∏), .has-info-icon label (display inline-flex), mobile adaptations (@media max-width 480px), dark mode (@media prefers-color-scheme dark), high contrast (@media prefers-contrast high), print styles (hide hints)"

      - name: "fees.yml"
        parent_module: "config_data"
        description: "–°—Ç—Ä–∞–Ω—ã, –≤–∞–ª—é—Ç–∞ –ø–æ–∫—É–ø–∫–∏, —Ñ—Ä–∞—Ö—Ç, –±–∞–∑–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã/—Ç–∏–µ—Ä—ã"
      - name: "commissions.yml"
        parent_module: "config_data"
        description: "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (default_commission_usd: 1000, by_country.uae.commission_usd: 0) –∏ —Å–ø–µ—Ü–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –≤ –∫–æ–¥–µ) —Å–µ–∫—Ü–∏—è bank_commission: enabled, percent (0‚Äì10% —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω), meta.recommended_min/max, warn_above, default_percent, –∞ —Ç–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ–µ –±—É–¥—É—â–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ by_component. –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ YAML-–∫–æ–Ω—Ñ–∏–≥–∏ –≤ tests/test_data/config (commissions_company_only.yml, commissions_with_bank.yml), —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É —Å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º."
      - name: "rates.yml"
        parent_module: "config_data"
        description: "–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã, —É—Ç–∏–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–±–æ—Ä (utilization_m1_personal: 2D-—Ç–∞–±–ª–∏—Ü–∞ –æ–±—ä—ë–º+–º–æ—â–Ω–æ—Å—Ç—å, 80+ –∑–∞–ø–∏—Å–µ–π), –≠–†–ê-–ì–õ–û–ù–ê–°–° (era_glonass_rub: 45000), –ø—Ä–æ—á–∏–µ —Å—Ç–∞–≤–∫–∏"
      - name: "duties.yml"
        parent_module: "config_data"
        description: "–ü–æ—à–ª–∏–Ω—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –æ–±—ä—ë–º—É; –±—Ä—ç–∫–µ—Ç –¥–ª—è <3 –ª–µ—Ç"

      - name: "functional/test_api.py"
        parent_module: "tests"
        description: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ /api/rates, /api/meta, /api/calculate"
      - name: "functional/test_engine.py"
        parent_module: "tests"
        description: "–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ e2e-–∫–µ–π—Å—ã —Ä–∞—Å—á—ë—Ç–∞ —á–µ—Ä–µ–∑ API –ø–æ cases.yml"
      - name: "functional/test_cbr.py"
        parent_module: "tests"
        description: "–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç –ø–∞—Ä—Å–µ—Ä–∞ CBR XML –∏ get_effective_rates (monkeypatch)"
      - name: "conftest.py"
        parent_module: "tests"
        description: "–§–∏–∫—Å—Ç—É—Ä–∞ TestClient(app) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã.

          –í —Ç.—á. _ensure_test_commissions_defaults: –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –ø–æ–¥–º–µ–Ω—è–ª–∞ cfg.commissions
          legacy-—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ø–æ—Ä–æ–≥–æ–≤ (thresholds). –í —Ä–∞–º–∫–∞—Ö –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ v2-—Å—Ö–µ–º—É –∫–æ–º–∏—Å—Å–∏–π
          –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ YAML-–∫–æ–Ω—Ñ–∏–≥–∞ commissions_company_only.yml,
          —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ —Å config/commissions.yml (default_commission_usd/by_country –∏ –±–µ–∑
          —Å–µ–∫—Ü–∏–∏ bank_commission). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç
          –≤ –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å commissions_with_bank.yml –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
          bank_commission_runtime_support –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –±–æ–µ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥."

    components:
      - name: "AppSettings"
        parent_file: "settings.py"
        type: "class"
        description: "–ó–∞–≥—Ä—É–∑–∫–∞ ENV, —Ñ–ª–∞–≥–∏ (ENABLE_LIVE_CBR –∏ –¥—Ä.), –¥–µ—Ä–∏–≤–∞—Ç–∏–≤—ã (webapp_url, countries_list)"
        testable: true
        test_priority: "medium"

      - name: "ConfigRegistry.load"
        parent_file: "settings.py"
        type: "function"
        description: "–ß—Ç–µ–Ω–∏–µ YAML-–∫–æ–Ω—Ñ–∏–≥–æ–≤, —Ö—ç—à –∏ –º–µ—Ç–∞-–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏"
        testable: true
        test_priority: "medium"

      - name: "get_settings / get_configs"
        parent_file: "settings.py"
        type: "function"
        description: "–ö–µ—à–∏—Ä—É–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤"
        testable: true
        test_priority: "medium"

      - name: "CalculationRequest"
        parent_file: "models.py"
        type: "class"
        description: "–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞ (–≥–æ–¥, –≤–∞–ª—é—Ç–∞, —Ç–∏–ø—ã), –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è currency"
        testable: true
        test_priority: "high"

      - name: "CostBreakdown"
        parent_file: "models.py"
        type: "class"
        description: "–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–µ–π –≤ RUB"
        testable: true
        test_priority: "medium"

      - name: "CalculationMeta"
        parent_file: "models.py"
        type: "class"
        description: "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç–∞: –≤–æ–∑—Ä–∞—Å—Ç/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—Å—Ç–∞–≤–∫–∏/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã. –í –±—É–¥—É—â–µ–º (—Å–º. SPRINT 1) –ø–æ–ª–µ rates_used –¥–æ–ª–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã base_rate, bank_commission_percent –∏ effective_rate –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤–∏–¥–∞ 'BASE_RATE [+ X%]'."
        testable: true
        test_priority: "medium"

      - name: "CalculationResult"
        parent_file: "models.py"
        type: "class"
        description: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞ (breakdown, meta, warnings)"
        testable: true
        test_priority: "low"

      - name: "WarningItem"
        parent_file: "models.py"
        type: "class"
        description: "–ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: code (SANCTIONS_UNKNOWN, JAPAN_CURRENCY, NO_DUTY, NON_M1), message"
        testable: true
        test_priority: "low"

      - name: "CalculationError"
        parent_file: "engine.py"
        type: "class"
        description: "Domain exception –¥–ª—è –æ—à–∏–±–æ–∫ —Ä–∞—Å—á—ë—Ç–∞ (missing_currency_rate classmethod)"
        testable: true
        test_priority: "medium"

      - name: "calculate"
        parent_file: "engine.py"
        type: "function"
        description: "–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞: get_effective_rates, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è purchase_price, _compute_duty, _utilization_fee (—Ç–æ–ª—å–∫–æ M1), customs_services, —Ñ—Ä–∞—Ö—Ç, country_expenses, –∫–æ–º–∏—Å—Å–∏—è, –∏—Ç–æ–≥–æ; tracking used_currency_codes –¥–ª—è meta.rates_used; warnings: SANCTIONS_UNKNOWN, NON_M1"
        testable: true
        test_priority: "high"

      - name: "_compute_duty"
        parent_file: "engine.py"
        type: "function"
        description: "–†–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã: <3 –ª–µ—Ç –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (EUR), 3-5/>5 –ø–æ —Å—Ç–∞–≤–∫–µ ‚Ç¨/—Å–º¬≥"
        testable: true
        test_priority: "medium"

      - name: "_utilization_fee"
        parent_file: "engine.py"
        type: "function"
        description: "DEPRECATED: –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ (—Ç–æ–ª—å–∫–æ –ø–æ –æ–±—ä—ë–º—É), –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ _utilization_fee_v2"
        testable: true
        test_priority: "low"

      - name: "_utilization_fee_v2"
        parent_file: "engine.py"
        type: "function"
        description: "–†–∞—Å—á—ë—Ç —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ –ø–æ 2D-—Ç–∞–±–ª–∏—Ü–µ (–æ–±—ä—ë–º+–º–æ—â–Ω–æ—Å—Ç—å): –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ª.—Å.‚Üí–∫–í—Ç (√ó0.7355), –ø–æ–∏—Å–∫ volume_band (5 bands), –ø–æ–∏—Å–∫ power_bracket –ø–æ power_kw, –≤—ã–±–æ—Ä –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ (lt3/gt3), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (fee_rub, coefficient). –í—Ö–æ–¥—ã: engine_cc, engine_power_hp, vehicle_age_years. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç config/rates.yml:utilization_m1_personal"
        testable: true
        test_priority: "high"

      - name: "_commission"
        parent_file: "engine.py"
        type: "function"
        description: "–ö–æ–º–∏—Å—Å–∏—è –ø–æ –ø–æ—Ä–æ–≥–∞–º –æ—Ç —Ü–µ–Ω—ã –ø–æ–∫—É–ø–∫–∏ –≤ RUB; –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç per-country override (by_country)"
        testable: true
        test_priority: "medium"

      - name: "_convert_from_rub"
        parent_file: "engine.py"
        type: "function"
        description: "–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RUB ‚Üí —Ü–µ–ª–µ–≤—É—é –≤–∞–ª—é—Ç—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ Japan tiers –≤ JPY)"
        testable: true
        test_priority: "low"

      - name: "_currency_rate"
        parent_file: "engine.py"
        type: "function"
        description: "–ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ {CODE}_RUB –∏–∑ rates_conf, raises CalculationError –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
        testable: true
        test_priority: "high"

      - name: "_select_freight"
        parent_file: "engine.py"
        type: "function"
        description: "–í—ã–±–æ—Ä —Ñ—Ä–∞—Ö—Ç–∞ (—Ç–∏–ø+–≤–∞–ª—é—Ç–∞) —Å –∫–æ–Ω—Ñ–∏–≥‚Äë–¥–µ—Ñ–æ–ª—Ç–æ–º"
        testable: true
        test_priority: "low"

      - name: "_japan_country_expenses / _other_country_expenses"
        parent_file: "engine.py"
        type: "function"
        description: "–°—Ç—Ä–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: –Ø–ø–æ–Ω–∏—è –ø–æ —Ç–∏—Ä—É —Ü–µ–Ω—ã (–≤ JPY), –ø—Ä–æ—á–∏–µ ‚Äî —Å—É–º–º–∞ –±–∞–∑–æ–≤—ã—Ö"
        testable: true
        test_priority: "low"

      - name: "get_age_category / get_passing_category"
        parent_file: "tariff_tables.py"
        type: "function"
        description: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∏ ¬´–ø—Ä–æ—Ö–æ–¥–Ω–æ–π¬ª –∫–∞—Ç–µ–≥–æ—Ä–∏–π"
        testable: true
        test_priority: "medium"

      - name: "find_duty_rate / find_lt3_value_bracket / format_volume_band"
        parent_file: "tariff_tables.py"
        type: "function"
        description: "–ü–æ–∏—Å–∫ —Å—Ç–∞–≤–∫–∏ –ø–æ—à–ª–∏–Ω—ã/–±—Ä—ç–∫–µ—Ç–æ–≤ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤"
        testable: true
        test_priority: "medium"

      - name: "to_decimal / quantize4 / round_rub"
        parent_file: "rounding.py"
        type: "function"
        description: "–ß–∏—Å–ª–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –¥–µ–Ω–µ–∂–Ω–æ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ (RUB)"
        testable: true
        test_priority: "medium"

      - name: "CBRRatesService"
        parent_file: "cbr.py"
        type: "class"
        description: "–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–µ—Ä–≤–∏—Å: _cache (CacheEntry | None), _lock (threading.Lock), _parse_xml, _is_cache_valid, @retry _do_fetch (httpx.get + parse), fetch_rates (TTL check, pytest guard, force override)"
        testable: true
        test_priority: "high"

      - name: "parse_cbr_xml"
        parent_file: "cbr.py"
        type: "function"
        description: "–ü–∞—Ä—Å–∏–Ω–≥ XML CBR (ET.fromstring): –∏—â–µ—Ç Valute/CharCode+VunitRate, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ _load_currency_codes, –∑–∞–º–µ–Ω—è–µ—Ç –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {CODE_RUB: float}"
        testable: true
        test_priority: "high"

      - name: "get_effective_rates"
        parent_file: "cbr.py"
        type: "function"
        description: "–°–ª–∏—è–Ω–∏–µ static rates —Å cbr_service.fetch_rates() (–µ—Å–ª–∏ enable_live_cbr=true); –∫–æ–ø–∏—Ä—É–µ—Ç base_conf, –æ–±–Ω–æ–≤–ª—è–µ—Ç currencies, –¥–æ–±–∞–≤–ª—è–µ—Ç live_source='cbr' –∏–ª–∏ None"
        testable: true
        test_priority: "high"

      - name: "fetch_cbr_rates"
        parent_file: "cbr.py"
        type: "function"
        description: "Alias –¥–ª—è cbr_service.fetch_rates() ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–∞—Ö –¥–ª—è monkeypatch"
        testable: true
        test_priority: "medium"

      - name: "cbr_service"
        parent_file: "cbr.py"
        type: "global"
        description: "Singleton –∏–Ω—Å—Ç–∞–Ω—Å CBRRatesService –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cache"
        testable: false
        test_priority: "n/a"

      - name: "CacheEntry"
        parent_file: "cbr.py"
        type: "class"
        description: "NamedTuple: rates (dict[str, float]), fetched_at (float timestamp)"
        testable: false
        test_priority: "n/a"

      - name: "CBRFetchError"
        parent_file: "cbr.py"
        type: "class"
        description: "Exception –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö fetch/parse CBR XML"
        testable: false
        test_priority: "n/a"

      - name: "calculate_endpoint"
        parent_file: "routes.py"
        type: "function"
        description: "POST /api/calculate ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ pydantic –∏ –≤—ã–∑–æ–≤ calculate"
        testable: true
        test_priority: "high"

      - name: "get_rates / get_meta / health / refresh_rates"
        parent_file: "routes.py"
        type: "function"
        description: "–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–¥–æ—Ä–æ–≤—å—è, —Ñ–æ—Ä—Å‚Äë–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤"
        testable: true
        test_priority: "high"

      - name: "create_app / rate_limit_middleware / lifespan"
        parent_file: "main.py"
        type: "function"
        description: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI, CORS, rate limit, —Å—Ç–∞—Ç–∏–∫–∞ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã"
        testable: true
        test_priority: "medium"

      - name: "setup_logging / logger"
        parent_file: "struct_logger.py"
        type: "function"
        description: "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è structlog –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä"
        testable: true
        test_priority: "low"

      - name: "_build_bot / _build_dispatcher / _set_commands / main_async / run_bot"
        parent_file: "app/bot/main.py"
        type: "function"
        description: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞), —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤, polling"
        testable: true
        test_priority: "medium"

      - name: "cmd_start / cmd_calc / on_webapp_data / _format_result / register"
        parent_file: "app/bot/handlers/start.py"
        type: "function"
        description: "–•–µ–Ω–¥–ª–µ—Ä—ã aiogram (NEW: cmd_calc —Å engine_power_hp=110, on_webapp_data —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π engine_power_hp, –æ–±—Ä–∞–±–æ—Ç–∫–æ–π ValidationError), _format_result helper (HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –º–æ—â–Ω–æ—Å—Ç—å—é –≤ –∫–í—Ç, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —É—Ç–∏–ª—å—Å–±–æ—Ä–∞, breakdown, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏), –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–≤–∏–∂–∫–æ–º —Ä–∞—Å—á—ë—Ç–∞"
        testable: true
        test_priority: "high"

      - name: "main_menu"
        parent_file: "app/bot/keyboards.py"
        type: "function"
        description: "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å WebApp-–∫–Ω–æ–ø–∫–æ–π"
        testable: true
        test_priority: "low"

      - name: "FormValidator"
        parent_file: "validator.js"
        type: "class"
        description: "–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞: validate(formData) ‚Üí {isValid, errors[]}, validateField(fieldName, value) ‚Üí error|null, getFieldConstraints(fieldName) ‚Üí {min, max, step, required}, addCustomValidator/removeCustomValidator/clearCustomValidators; —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å backend Pydantic –º–æ–¥–µ–ª—è–º–∏; real-time –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ"
        testable: true
        test_priority: "high"

      - name: "APIClient"
        parent_file: "api.js"
        type: "class"
        description: "HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API: calculate(requestData), getMeta(), getRates(), refreshRates(force); –≤–Ω—É—Ç—Ä–∏: _request(method, endpoint, data, options) —Å retry (max 3), timeout (10s), payload size check (10MB), _handleError —Å –º–∞–ø–ø–∏–Ω–≥–æ–º HTTP —Å—Ç–∞—Ç—É—Å–æ–≤ ‚Üí APIError; singleton pattern"
        testable: true
        test_priority: "high"

      - name: "APIError"
        parent_file: "api.js"
        type: "class"
        description: "–ö–∞—Å—Ç–æ–º–Ω–∞—è –æ—à–∏–±–∫–∞ API: code (enum: NETWORK_ERROR, TIMEOUT, VALIDATION_ERROR, etc.), httpStatus, originalError, getUserMessage() ‚Üí user-friendly —Ç–µ–∫—Å—Ç, toLogFormat() ‚Üí –¥–µ—Ç–∞–ª–∏ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫"
        testable: true
        test_priority: "medium"

      - name: "UI"
        parent_file: "ui.js"
        type: "class"
        description: "–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏: state management (_state: idle/loading/error/success, getState(), _setState()), –º–µ—Ç–æ–¥—ã –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è: showLoading(text)/hideLoading, showError(msg)/hideError, showResult/hideResult, showShareButton/hideShareButton, scrollToResult (smooth scroll), disableForm/enableForm, reset; showToast(message, type, duration) –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π; –∞–Ω–∏–º–∞—Ü–∏–∏: _fadeIn/_fadeOut (CSS transitions); Telegram haptic feedback (_hapticFeedback); accessibility: ARIA attributes (role, aria-live, aria-busy), focus management; singleton pattern"
        testable: true
        test_priority: "high"

  tests:
    test_status:
      overall: "41 passed, 1 skipped (v2.0.0 released)"
      functional_tests: "13 passed (test_engine.py - all cases with engine_power_hp)"
      unit_tests: "18 passed, 1 skipped (test_utilization_v2.py - comprehensive 2D table coverage)"
      api_tests: "5 passed (test_api.py - includes engine_power_hp validation)"
      coverage: "87% overall, ~95% for _utilization_fee_v2(), 100% for calculate() integration flow"
      last_updated: "2025-12-08"

    unit_tests:
      - target_component: "_utilization_fee_v2"
        test_file: "tests/unit/test_utilization_v2.py"
        test_functions: ["test_utilization_fee_calculation (11 parametrized cases)", "test_utilization_fee_hp_to_kw_conversion", "test_utilization_fee_edge_case_boundary", "test_utilization_fee_zero_power", "test_utilization_fee_all_age_categories", "test_utilization_fee_different_countries", "test_utilization_fee_high_power_vehicle", "test_utilization_fee_low_power_vehicle"]
        coverage_status: "exists"
        notes: "SPRINT 8: –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ 2025 - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ª.—Å.‚Üí–∫–í—Ç (0.7355), –≤—Å–µ 5 –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –æ–±—ä—ë–º–∞ (‚â§1000, 1001-2000, 2001-3000, 3001-3500, >3500 cc), –≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (lt3, 3_5, gt5), –≥—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (0hp, 1hp, 400hp), boundary cases –º–µ–∂–¥—É –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏. Coverage ~95%"
      - target_component: "parse_cbr_xml"
        test_file: "tests/functional/test_cbr.py"
        test_functions: ["test_parse_cbr_xml_basic"]
        coverage_status: "exists"
        notes: "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ sample XML —Å USD/EUR/JPY/CNY/AED"
      - target_component: "get_effective_rates"
        test_file: "tests/functional/test_cbr.py"
        test_functions: ["test_get_effective_rates_monkeypatch"]
        coverage_status: "exists"
        notes: "Monkeypatch fake_fetch, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ª–∏—è–Ω–∏–µ —Å base rates"
      - target_component: "CalculationRequest.validate_year"
        test_file: "-"
        test_functions: []
        coverage_status: "missing"
        priority: "HIGH"
        recommendation: "–î–æ–±–∞–≤–∏—Ç—å tests/unit/test_models.py —Å —Ç–µ—Å—Ç–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ year (future, <1990)"
      - target_component: "round_rub / to_decimal / quantize4"
        test_file: "-"
        test_functions: []
        coverage_status: "missing"
        priority: "HIGH"
        recommendation: "–î–æ–±–∞–≤–∏—Ç—å tests/unit/test_rounding.py –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è RUB –∏ Decimal conversion"
      - target_component: "tariff_tables: get_age_category, find_duty_rate, find_lt3_value_bracket"
        test_file: "-"
        test_functions: []
        coverage_status: "missing"
        priority: "MEDIUM"
        recommendation: "–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫"
      - target_component: "rate_limit_middleware"
        test_file: "-"
        test_functions: []
        coverage_status: "missing"
        priority: "HIGH"
        recommendation: "–î–æ–±–∞–≤–∏—Ç—å tests/unit/test_middleware.py –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ 429 response –∏ cleanup"
      - target_component: "_commission with per-country override"
        test_file: "-"
        test_functions: []
        coverage_status: "missing"
        priority: "MEDIUM"
        recommendation: "–¢–µ—Å—Ç fallback –Ω–∞ global thresholds vs by_country"
      - target_component: "_utilization_fee –¥–ª—è gt5 fallback"
        test_file: "-"
        test_functions: []
        coverage_status: "missing"
        priority: "MEDIUM"
        recommendation: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É ge3 fallback –¥–ª—è gt5 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"

    integration_tests:
      - integration_point: "API -> Calculation Engine"
        test_description: "POST /api/calculate –¥–ª—è –Ω–∞–±–æ—Ä–∞ –∫–µ–π—Å–æ–≤ (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å—É–º–º –∏ –≤–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è)"
        test_file: "tests/functional/test_engine.py"
        coverage_status: "exists"
      - integration_point: "API -> Configs (rates/fees/commissions/duties)"
        test_description: "GET /api/rates –∏ /api/meta –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞"
        test_file: "tests/functional/test_api.py"
        coverage_status: "exists"
      - integration_point: "API -> CBR Service (refresh)"
        test_description: "POST /api/rates/refresh —Ñ–æ—Ä—Å–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ CBR"
        test_file: "-"
        coverage_status: "needed"
      - integration_point: "Bot -> Engine"
        test_description: "–•–µ–Ω–¥–ª–µ—Ä—ã /calc –∏ web_app_data –≤—ã–∑—ã–≤–∞—é—Ç calculate –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
        test_file: "-"
        coverage_status: "needed"
      - integration_point: "App Static -> WebApp"
        test_description: "–†–∞–∑–¥–∞—á–∞ /web/, /manifest.json, /sw.js"
        test_file: "-"
        coverage_status: "needed"

  edges:
    inter_module_flows:
      - from: "app_core"
        to: "app_calculation"
        data_type: "ConfigRegistry (rates, duties, fees, commissions)"
        description: "engine.calculate –∏—Å–ø–æ–ª—å–∑—É–µ—Ç get_configs() –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤"
      - from: "app_services"
        to: "app_calculation"
        data_type: "dict (currencies merged, live_source)"
        description: "get_effective_rates –ø–æ–¥–º–µ—à–∏–≤–∞–µ—Ç live-–∫—É—Ä—Å—ã –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π"
      - from: "app_api"
        to: "app_calculation"
        data_type: "CalculationRequest -> CalculationResult"
        description: "REST —Å–ª–æ–π –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥ –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤ –¥–≤–∏–∂–æ–∫ —Ä–∞—Å—á—ë—Ç–∞"
      - from: "app_main"
        to: "app_api"
        data_type: "APIRouter"
        description: "main.create_app –º–æ–Ω—Ç–∏—Ä—É–µ—Ç router —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º /api"
      - from: "app_bot"
        to: "app_calculation"
        data_type: "CalculationRequest (—Å–æ–±—Ä–∞–Ω–Ω—ã–π –≤ –∫–æ–¥–µ) -> CalculationResult"
        description: "–•–µ–Ω–¥–ª–µ—Ä—ã –±–æ—Ç–∞ –≤—ã–∑—ã–≤–∞—é—Ç calculate –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö WebApp"
      - from: "config_data"
        to: "app_core"
        data_type: "YAML -> dict"
        description: "settings.ConfigRegistry.load –∑–∞–≥—Ä—É–∂–∞–µ—Ç YAML –≤ —Å–ª–æ–≤–∞—Ä–∏"
      - from: "app_services"
        to: "app_core"
        data_type: "settings"
        description: "CBR-—Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AppSettings –¥–ª—è URL, TTL –∏ —Ñ–ª–∞–≥–æ–≤ live"

    intra_module_dependencies:
      - from: "engine.py"
        to: "models.py"
        dependency_type: "import"
        description: "–¢–∏–ø—ã CalculationRequest/Result, CostBreakdown, Meta"
      - from: "engine.py"
        to: "rounding.py"
        dependency_type: "import"
        description: "–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∏ Decimal-—É—Ç–∏–ª–∏—Ç—ã"
      - from: "engine.py"
        to: "tariff_tables.py"
        dependency_type: "import"
        description: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Å—Ç–∞–≤–æ–∫ –ø–æ—à–ª–∏–Ω—ã"
      - from: "engine.py"
        to: "cbr.py"
        dependency_type: "import"
        description: "get_effective_rates –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç"
      - from: "routes.py"
        to: "engine.py"
        dependency_type: "import"
        description: "–í—ã–∑–æ–≤ calculate() –∏–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞"
      - from: "routes.py"
        to: "settings.py"
        dependency_type: "import"
        description: "–ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤/–Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ /rates, /meta, /health"
      - from: "app/main.py"
        to: "app/api/routes.py"
        dependency_type: "import"
        description: "–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —Ä–æ—É—Ç–µ—Ä–∞"
      - from: "app/bot/handlers/start.py"
        to: "app/bot/keyboards.py"
        dependency_type: "import"
        description: "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è WebApp"
      - from: "app/bot/handlers/start.py"
        to: "engine.py"
        dependency_type: "import"
        description: "–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ WebApp-–¥–∞–Ω–Ω—ã—Ö"

    component_relationships:
      - from: "calculate"
        to: "_compute_duty"
        relationship: "calls"
        description: "–†–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ–±—ä—ë–º—É"
      - from: "calculate"
        to: "_utilization_fee"
        relationship: "calls"
        description: "–ü–æ–¥–±–æ—Ä —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ M1"
      - from: "calculate"
        to: "_commission"
        relationship: "calls"
        description: "–ö–æ–º–∏—Å—Å–∏—è –ø–æ –ø–æ—Ä–æ–≥–∞–º"
      - from: "calculate"
        to: "get_effective_rates"
        relationship: "uses"
        description: "–ü–æ–¥–º–µ—à–∏–≤–∞–Ω–∏–µ live‚Äë–∫—É—Ä—Å–æ–≤ CBR –ø–æ–≤–µ—Ä—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö"
      - from: "_compute_duty"
        to: "find_lt3_value_bracket / find_duty_rate"
        relationship: "uses"
        description: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫ –ø–æ—à–ª–∏–Ω—ã"
      - from: "calculate_endpoint"
        to: "calculate"
        relationship: "calls"
        description: "–ì–ª–∞–≤–Ω—ã–π API-—ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–∞—Å—á—ë—Ç–∞"
      - from: "get_rates / get_meta / health"
        to: "get_configs / get_settings"
        relationship: "uses"
        description: "–ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"
      - from: "get_effective_rates"
        to: "fetch_cbr_rates"
        relationship: "calls"
        description: "–ó–∞–≥—Ä—É–∑–∫–∞ live‚Äë–∫—É—Ä—Å–æ–≤ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ"
      - from: "CBRRatesService._do_fetch"
        to: "httpx.get"
        relationship: "calls"
        description: "–ó–∞–ø—Ä–æ—Å XML CBR –∏ —Ä–∞–∑–±–æ—Ä"
      - from: "create_app"
        to: "api.router"
        relationship: "uses"
        description: "–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
      - from: "rate_limit_middleware"
        to: "JSONResponse"
        relationship: "uses"
        description: "–û—Ç–≤–µ—Ç 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞"
      - from: "cmd_calc / on_webapp_data"
        to: "calculate"
        relationship: "calls"
        description: "–†–∞—Å—á—ë—Ç –ø–æ –∫–æ–º–∞–Ω–¥–µ –±–æ—Ç–∞ –∏ –¥–∞–Ω–Ω—ã–º WebApp"
      - from: "app_calculation"
        to: "app_api"
        description: "engine.calculate() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç CalculationResult, –≤–∫–ª—é—á–∞—é—â–∏–π CostBreakdown –∏ CalculationMeta. –í CalculationMeta —Ö—Ä–∞–Ω–∏—Ç—Å—è rates_used: –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç–Ω–æ–π –ø–∞—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, USD_RUB) –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è base_rate, bank_commission_percent, effective_rate –∏ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è UI –≤–∏–¥–∞ 'BASE_RATE [+ PERCENT%]'. API –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –ª–∏—à—å —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –∏—Ö –≤ JSON."
      - from: "app_api"
        to: "app_webapp"
        description: "WebApp –≤—ã–∑—ã–≤–∞–µ—Ç POST /api/calculate –∏ –ø–æ–ª—É—á–∞–µ—Ç JSON —Å breakdown, meta –∏ request. –ò–∑ meta.rates_used WebApp –±–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫—É –∫—É—Ä—Å–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'USD/RUB = 78.95 + 1%') –∏ –Ω–µ –∑–Ω–∞–µ—Ç –Ω–∏—á–µ–≥–æ –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ñ–æ—Ä–º—É–ª–µ effective_rate –∏–ª–∏ —Å—É–º–º–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏. –í breakdown –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π 'bank_commission_*'."
      - from: "app_api"
        to: "app_bot"
        description: "Telegram-–±–æ—Ç (—á–µ—Ä–µ–∑ engine.calculate –∏–ª–∏ –∫–æ—Å–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ API) –ø–æ–ª—É—á–∞–µ—Ç CalculationResult –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç meta.rates_used –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –∫—É—Ä—Å–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ (–∞–Ω–∞–ª–æ–≥ WebApp). –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π, —Ç–æ–ª—å–∫–æ –∫–∞–∫ '+ X%' —Ä—è–¥–æ–º —Å –±–∞–∑–æ–≤—ã–º –∫—É—Ä—Å–æ–º."
      - from: "config_data"
        to: "app_calculation"
        description: "–î–≤–∏–∂–æ–∫ —á–∏—Ç–∞–µ—Ç config/commissions.yml::bank_commission (enabled, percent) –∏ config/rates.yml (base_rate), –≤—ã—á–∏—Å–ª—è–µ—Ç effective_rate = base_rate √ó (1 + bank_commission_percent/100) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ RUB. –ü—Ä–∏ —ç—Ç–æ–º –≤ JSON-–æ—Ç–≤–µ—Ç–µ /api/calculate –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª–µ–º; –µ—ë —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ breakdown.total_rub –∏ –≤ meta.rates_used.display."
      - from: "app_calculation"
        to: "app_webapp"
        description: "–ß–µ—Ä–µ–∑ API –¥–≤–∏–∂–æ–∫ –ø–µ—Ä–µ–¥–∞—ë—Ç WebApp CalculationResult; WebApp –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ meta.rates_used –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—É—Ä—Å–∞ 'BASE_RATE [+ PERCENT%]' –∏ –Ω–∞ breakdown –¥–ª—è —Å—É–º–º –≤ —Ä—É–±–ª—è—Ö."
      - from: "app_calculation"
        to: "app_bot"
        description: "–ß–µ—Ä–µ–∑ API –∏/–∏–ª–∏ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –¥–≤–∏–∂–∫–∞ –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç CalculationResult –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∏—Å–ø–æ–ª—å–∑—É—è breakdown.total_rub –∏ meta.rates_used. –ö–æ–º–∏—Å—Å–∏—è –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∞ –∫ –∫—É—Ä—Å—É, –∞ –Ω–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏."
