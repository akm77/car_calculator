rpg:
  metadata:
    project_name: "car_calculator"
    description: "FastAPI-—Å–µ—Ä–≤–∏—Å –∏ Telegram-–±–æ—Ç –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤–≤–æ–∑–∞ –∞–≤—Ç–æ –Ω–∞ –±–∞–∑–µ —Ç–∞—Ä–∏—Ñ–æ–≤, –∫–æ–º–∏—Å—Å–∏–π –∏ –≤–∞–ª—é—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ YAML + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ live CBR)."
    version: "2.0.0"
    python_version: "3.13"
    total_lines_of_code: 1990
    last_updated: "2025-12-08"
    architecture: "–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏: API, Calculation Engine, Bot, Services"
    supported_countries: ["japan", "korea", "uae", "china", "georgia"]
    recent_changes:
      - date: "2025-12-08"
        description: "SPRINT 1 SPEC COMPLETED: –§–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∞ –∫ –≤–∞–ª—é—Ç–Ω–æ–º—É –∫—É—Ä—Å—É –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (SPEC + RPG) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è bank_commission –≤ config/commissions.yml (enabled, percent, meta.recommended_min/max, warn_above, default_percent), –æ–ø–∏—Å–∞–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç effective_rate = base_rate √ó (1 + bank_commission_percent/100), –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ total_rub –∏ CalculationMeta.rates_used (base_rate, bank_commission_percent, effective_rate), —Ä–∞–∑–≤–µ–¥–µ–Ω—ã –ø–æ–Ω—è—Ç–∏—è '–∫–æ–º–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏' (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 1000 USD) –∏ '–±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è' (–ø—Ä–æ—Ü–µ–Ω—Ç –∫ –∫—É—Ä—Å—É)."
      - date: "2025-12-15"
        description: "SPRINT 4.5‚Äì4.8 COMPLETED: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á—Ç–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ bank_commission –∏–∑ config/commissions.yml –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö –¥–≤–∏–∂–∫–∞; –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª—è meta.rates_used –∏ meta.detailed_rates_used –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –∏ –Ω–∞–¥–±–∞–≤–∫–∏ '+ P%'; –æ–±–Ω–æ–≤–ª–µ–Ω—ã SPECIFICATION.md, MIGRATION_GUIDE.md –∏ rpg.yaml, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤–µ—Ç–∫–∞ bank_commission_runtime_support –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —É—Ä–æ–≤–Ω–µ runtime –∏ —Ç–µ—Å—Ç–æ–≤ (unit + functional)."
  nodes:
    modules:
      - name: "app_core"
        path: "app/core"
        description: "–ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è"
      - name: "app_calculation"
        path: "app/calculation"
        description: "–î–≤–∏–∂–æ–∫ —Ä–∞—Å—á—ë—Ç–∞, –º–æ–¥–µ–ª–∏, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∏ —Ç–∞—Ä–∏—Ñ–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã. –í —Ç–æ–º —á–∏—Å–ª–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∏ –∫ –≤–∞–ª—é—Ç–Ω—ã–º –∫—É—Ä—Å–∞–º (effective_rate) –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ CalculationMeta.rates_used/detailed_rates_used –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤."
      - name: "app_services"
        path: "app/services"
        description: "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–∫—É—Ä—Å—ã CBR, —Å–ª–∏—è–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö/–∂–∏–≤—ã—Ö –∫—É—Ä—Å–æ–≤)"
      - name: "app_api"
        path: "app/api"
        description: "HTTP API-–º–∞—Ä—à—Ä—É—Ç—ã FastAPI. –°–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç CalculationResult (breakdown, meta, request) –≤ JSON –∏ –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç meta.rates_used/detailed_rates_used –∫–ª–∏–µ–Ω—Ç–∞–º –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏."
      - name: "app_main"
        path: "app"
        description: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI, CORS middleware, rate limiting, —Å—Ç–∞—Ç–∏–∫–∞ (/web, /static), —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å /, manifest.json, sw.js, /ping, /debug/files; lifespan –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤"
      - name: "app_bot"
        path: "app/bot"
        description: "Telegram-–±–æ—Ç (aiogram). –ü–æ–ª—É—á–∞–µ—Ç CalculationResult –æ—Ç –¥–≤–∏–∂–∫–∞ / API –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç HTML-—Å–æ–æ–±—â–µ–Ω–∏—è —Å breakdown –∏ —Å—Ç—Ä–æ–∫–æ–π –∫—É—Ä—Å–∞, –∏—Å–ø–æ–ª—å–∑—É—è —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (display –≤ CalculationMeta.detailed_rates_used). –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∞ '+ X%' –∫ –∫—É—Ä—Å—É, –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π/–∫–æ–º–∞–Ω–¥ –¥–ª—è –µ—ë –∏–∑–º–µ–Ω–µ–Ω–∏—è."
      - name: "app_bot_config"
        path: "app/bot/handlers/config.py"
        description: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ YAML-—Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ Telegram. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Å–∫–∞—á–∏–≤–∞—Ç—å, –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ (fees, commissions, rates, duties) –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É. –í–∫–ª—é—á–∞–µ—Ç FSM –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏, 4-level –≤–∞–ª–∏–¥–∞—Ü–∏—é YAML, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø, hot reload –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏ –∑–∞—â–∏—Ç—É –æ—Ç race conditions —Å asyncio.Lock."
        dependencies:
          - "app_core (ConfigRegistry, reload_configs)"
          - "app_bot (Router, FSM)"
        features:
          - "4 —Ç–∏–ø–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤: fees, commissions, rates, duties"
          - "FSM States –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏: ConfigUploadStates (waiting_for_fees/commissions/rates/duties)"
          - "Download commands: /get_{config} ‚Äî —Å–∫–∞—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ —á–µ—Ä–µ–∑ Telegram"
          - "Upload commands: /set_{config} ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥ —Å FSM"
          - "–ö–æ–º–∞–Ω–¥–∞ /cancel –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏"
          - "–ö–æ–º–∞–Ω–¥–∞ /list_configs –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤"
          - "–ö–æ–º–∞–Ω–¥–∞ /reload_configs –¥–ª—è hot reload –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"
          - "–ö–æ–º–∞–Ω–¥–∞ /config_status –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (hash + timestamp)"
          - "–ö–æ–º–∞–Ω–¥–∞ /config_diff –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –¥–∏—Å–∫–∞"
          - "Config versioning: hash + timestamp –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏"
          - "Graceful error handling —Å rollback –∫ —Å—Ç–∞—Ä—ã–º –∫–æ–Ω—Ñ–∏–≥–∞–º"
          - "Performance metrics: load_time_ms, hash_changed"
          - "4-level validation: filename (path traversal protection), size (‚â§1MB), YAML syntax (safe_load), structure (required_keys)"
          - "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø —Å timestamp (UTC): {filename}.backup.YYYYMMDD_HHMMSS"
          - "Race condition protection: asyncio.Lock per config type"
          - "–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–±–µ–∑ lock) + serial critical section (—Å lock)"
          - "–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤: shutil.move()"
          - "Zero-downtime deployment: –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞"
        components:
          - "ConfigFile enum: FEES, COMMISSIONS, RATES, DUTIES"
          - "CONFIG_METADATA: dict[ConfigFile, dict[str, Any]] —Å filename, description, required_keys"
          - "ConfigUploadStates: StatesGroup –¥–ª—è FSM –¥–∏–∞–ª–æ–≥–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏"
          - "_CONFIG_LOCKS: dict[ConfigFile, asyncio.Lock] –¥–ª—è concurrency protection"
          - "_get_config_lock(): Lazy initialization –¥–ª—è locks"
          - "validate_yaml_structure(): –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π"
          - "download_and_validate_config(): 4-level validation pipeline"
          - "backup_config_file(): –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø —Å shutil.copy2()"
          - "process_config_upload(): Generic upload handler —Å lock protection"
          - "cmd_reload_configs(): –ö–æ–º–∞–Ω–¥–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –≤ runtime"
          - "cmd_config_status(): –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤"
          - "cmd_config_diff(): –ö–æ–º–∞–Ω–¥–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –¥–∏—Å–∫–∞"
          - "Router 'config_handlers' –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≥–ª–∞–≤–Ω—ã–º –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –±–æ—Ç–∞"
        status: "SPRINT_CONFIG_05_COMPLETED"
        implemented_date: "2025-12-28"
        last_updated: "2025-12-29"
        test_coverage: "100% core (13/13 —Ç–µ—Å—Ç–æ–≤ –≤ test_config_reload.py + 24 —Ç–µ—Å—Ç–∞ –≤ test_config_upload.py + 21 —Ç–µ—Å—Ç –≤ test_config_handlers.py)"
        sprints_completed:
          - "CONFIG-01 (2025-12-28): –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (enums, states, metadata, helpers)"
          - "CONFIG-02 (2025-12-28): Download commands (/get_*, /list_configs)"
          - "CONFIG-03 (2025-12-28): Upload commands —Å FSM, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ race protection"
          - "CONFIG-04 (2025-12-28): AdminOnlyMiddleware –¥–ª—è –∑–∞—â–∏—Ç—ã –∫–æ–º–∞–Ω–¥"
          - "CONFIG-05 (2025-12-29): Hot reload –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (reload_configs, config_status, config_diff)"
        next_sprint: "CONFIG-06 (–§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)"
      - name: "app_webapp"
        path: "app/webapp"
        description: "–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π PWA —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞ —á–µ—Ä–µ–∑ /api/calculate –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç: breakdown (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –≤ —Ä—É–±–ª—è—Ö) –∏ —Å—Ç—Ä–æ–∫—É –∫—É—Ä—Å–∞ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî CalculationMeta.detailed_rates_used[CODE].display –≤–∏–¥–∞ 'USD/RUB = BASE [+ PERCENT%]'). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π ‚Äî –æ–Ω–∞ –∑–∞–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥–æ–º."
      - name: "app_webapp_hints"
        path: "app/webapp/css/hints.css + app/webapp/js/modules/hints.js"
        description: "–í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã (–≤–æ–∑—Ä–∞—Å—Ç, –º–æ—â–Ω–æ—Å—Ç—å) - MVP —Å–∏—Å—Ç–µ–º–∞ real-time —Ñ–∏–¥–±–µ–∫–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–≤—Ç–æ"
        components:
          - "hints.css - —Ü–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π (4 –∑–æ–Ω—ã), —Å—Ç–∏–ª–∏ –¥–ª—è tooltip –∏ hint text, –∞–Ω–∏–º–∞—Ü–∏–∏, —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞, a11y"
          - "hints.js - HintsManager –∫–ª–∞—Å—Å (getAgeHintData, getPowerHintData, applyHintToField, showHintText, initTooltips, attachFieldHints)"
          - "constants.js HINT_THRESHOLDS - –ø–æ—Ä–æ–≥–∏ –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–∞ (3-5 –ª–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ) –∏ –º–æ—â–Ω–æ—Å—Ç–∏ (160/200/300 –ª.—Å.)"
          - "messages.js hints - —Ç–µ–∫—Å—Ç—ã –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∑–æ–Ω (optimal/acceptable/warning/prohibitive)"
        features:
          - "–¶–≤–µ—Ç–æ–≤—ã–µ –∑–æ–Ω—ã: üü¢ optimal (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏), üîµ acceptable (–Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞—Å—Ç–∏), üü† warning (–≤—ã—Å–æ–∫–∏–µ), üî¥ prohibitive (–∑–∞–ø—Ä–µ—Ç–∏—Ç–µ–ª—å–Ω—ã–µ)"
          - "–ö—Ä–∞—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–¥ –ø–æ–ª—è–º–∏ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∑–æ–Ω—ã"
          - "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ ‚ÑπÔ∏è —Å tooltip'–∞–º–∏ (–ø–æ—Ä–æ–≥–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)"
          - "Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ (debounced 300ms –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)"
          - "Accessibility: ARIA attributes, keyboard support (Tab + Enter/Space), screen reader friendly"
          - "Smooth CSS transitions –º–µ–∂–¥—É —Ü–≤–µ—Ç–∞–º–∏"
          - "–ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (44x44px tap targets, responsive tooltips)"
          - "Dark mode support (prefers-color-scheme)"
          - "High contrast mode support"
        thresholds:
          age:
            optimal: "3-5 –ª–µ—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—à–ª–∏–Ω—ã)"
            prohibitive: "<3 –ª–µ—Ç (–≤—ã—Å–æ–∫–∞—è –ø–æ—à–ª–∏–Ω–∞ –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –∞–≤—Ç–æ)"
            warning: ">5 –ª–µ—Ç (–ø–æ—à–ª–∏–Ω–∞ –≤—ã—à–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π)"
          power:
            optimal: "‚â§160 –ª.—Å. (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ç–∏–ª—å—Å–±–æ—Ä 5,200‚ÇΩ)"
            acceptable: "160-200 –ª.—Å. (—É—Ç–∏–ª—å—Å–±–æ—Ä —Ä–∞—Å—Ç–µ—Ç)"
            warning: "200-300 –ª.—Å. (–≤—ã—Å–æ–∫–∏–π —É—Ç–∏–ª—å—Å–±–æ—Ä)"
            prohibitive: ">300 –ª.—Å. (–∑–∞–ø—Ä–µ—Ç–∏—Ç–µ–ª—å–Ω—ã–π, –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å —Ü–µ–Ω—É –∞–≤—Ç–æ)"
        files_changed:
          - "app/webapp/css/hints.css (NEW, 8.2K, 350+ lines)"
          - "app/webapp/js/modules/hints.js (NEW, 10K, 335 lines)"
          - "app/webapp/js/config/constants.js (MODIFIED, +23 lines)"
          - "app/webapp/js/config/messages.js (MODIFIED, +28 lines)"
          - "app/webapp/index.html (MODIFIED, +4 lines imports, +5 lines init)"
          - "tests/manual/test_hints_mvp.html (NEW, standalone test page)"
        time_spent: "2.5 —á–∞—Å–∞"
        implemented_date: "2025-12-08"
        reference_docs:
          - "docs/UI_HINTS_INTEGRATION_PROPOSAL.md (–ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è, –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)"
          - "docs/UI_HINTS_SUMMARY.md (–∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ, —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞)"
          - "docs/QUICK_REFERENCE_AGE_OPTIMAL.md (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ—Ä–æ–≥–∏ –ø–æ—à–ª–∏–Ω)"
          - "docs/QUICK_REFERENCE_POWER_LIMITS.md (–ø–æ—Ä–æ–≥–∏ –º–æ—â–Ω–æ—Å—Ç–∏, —É—Ç–∏–ª—å—Å–±–æ—Ä)"
          - "docs/SPRINT_MVP_HINTS_PROMPT.md (–ø—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ MVP)"
        structure:
          - "index.html - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, validator –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω)"
          - "index.html.backup - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (1548 —Å—Ç—Ä–æ–∫)"
          - "css/ - —Å—Ç–∏–ª–∏ (variables, base, components with validation styles, telegram)"
          - "js/config/ - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (constants.js ‚úÖ, messages.js ‚úÖ)"
          - "js/utils/ - —É—Ç–∏–ª–∏—Ç—ã (formatters.js ‚úÖ, dom.js ‚úÖ)"
          - "js/modules/ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (validator.js ‚úÖ, api.js ‚úÖ, ui.js ‚úÖ, results.js, calculator.js)"
          - "manifest.json, sw.js - PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç –∏ service worker"
          - "*.png - –∏–∫–æ–Ω–∫–∏ –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã"
        refactoring_status:
          stage: "SPRINT_6_COMPLETED"
          date: "2025-12-05"
          description: "–°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π UI –º–µ–Ω–µ–¥–∂–µ—Ä —Å state management –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏"
          components_created:
            - "js/modules/ui.js - UI –∫–ª–∞—Å—Å (state management: idle/loading/error/success, showError/showLoading/showResult/hideError/hideLoading/hideResult, showToast —Å —Ç–∏–ø–∞–º–∏, haptic feedback, accessibility ARIA, fade –∞–Ω–∏–º–∞—Ü–∏–∏)"
            - "js/modules/api.js - APIClient –∫–ª–∞—Å—Å (retry, timeout, error handling), APIError (—Ç–∏–ø–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫), —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã (calculate, getMeta, getRates, refreshRates)"
            - "js/modules/validator.js - FormValidator –∫–ª–∞—Å—Å (validate, validateField, getFieldConstraints, addCustomValidator)"
            - "js/config/messages.js - –≤—Å–µ UI —Ç–µ–∫—Å—Ç—ã (errors, buttons, labels, breakdown, warnings, share templates)"
            - "js/config/constants.js - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å models.py), API endpoints, –¥–µ—Ñ–æ–ª—Ç—ã, fallback metadata"
            - "js/utils/formatters.js - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (17 —Ñ—É–Ω–∫—Ü–∏–π)"
            - "js/utils/dom.js - DOM –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ (18 —Ñ—É–Ω–∫—Ü–∏–π)"
            - "css/components.css - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (.error, .field-error, animations)"
            - "index.html - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã FormValidator –∏ APIClient, —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å APIError.getUserMessage()"
            - "tests/manual/test_api_client.html - API test suite (8 —Ç–µ—Å—Ç–æ–≤: GET, POST, validation, network, timeout, retry, error types)"
            - "tests/manual/test_validator.html - comprehensive test suite (40+ test cases)"
          synchronization:
            - "Constraints.YEAR_MIN (1990) ‚Üî models.py @field_validator (year < 1990)"
            - "Constraints.ENGINE_CC_MIN/MAX (500-10000) ‚Üî models.py Field(gt=0)"
            - "Messages.errors ‚Üî app/core/messages.py (ERR_YEAR_FUTURE, ERR_YEAR_TOO_OLD)"
            - "FALLBACK_META.countries ‚Üî /api/meta response structure"
            - "FormValidator.validateField('year') ‚Üî CalculationRequest.year validator"
            - "FormValidator.validate() ‚Üî Backend Pydantic validation rules"
            - "APIClient.calculate() ‚Üî POST /api/calculate endpoint"
            - "APIError.getUserMessage() ‚Üî FastAPI error responses"
          next_stage: "SPRINT_6_UI_MODULE"
      - name: "config_data"
        path: "config"
        description: "YAML-–∫–æ–Ω—Ñ–∏–≥–∏ —Ç–∞—Ä–∏—Ñ–æ–≤: fees.yml, commissions.yml, rates.yml, duties.yml. –í —Ä–∞–º–∫–∞—Ö SPRINT 1 —Å–ø–µ—Ü–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ —Å–µ–∫—Ü–∏—è bank_commission –≤ commissions.yml; –≤ SPRINT 4 –æ–Ω–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–≤–∏–∂–∫–æ–º."

    files:
      - name: "settings.py"
        parent_module: "app_core"
        description: "AppSettings (Pydantic Settings, .env), ConfigRegistry (–∑–∞–≥—Ä—É–∑–∫–∞ fees/commissions/rates/duties.yml —Å —Ö—ç—à–µ–º –∏ timestamp), @lru_cache –≥–µ—Ç—Ç–µ—Ä—ã get_settings() –∏ get_configs(), reload_configs() –¥–ª—è hot reload –∫–æ–Ω—Ñ–∏–≥–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (cache clearing, versioning, metrics)"
        features:
          - "ConfigRegistry.load(): –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö 4 –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ YAML"
          - "get_configs() @lru_cache: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–≥–∞–º"
          - "reload_configs(): Hot reload - –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞, –º–µ—Ç—Ä–∏–∫–∏ (load_time_ms, hash_changed)"
          - "Config versioning: SHA-256 hash + ISO 8601 timestamp –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π"
          - "Graceful error handling: —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ reload"
          - "Performance measurement: time.time() –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è load_time_ms"
          - "Structured logging: logger.info/exception –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"
      - name: "messages.py"
        parent_module: "app_core"
        description: "–°—Ç—Ä–æ–∫–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π/–∏–Ω—Ñ–æ"

      - name: "engine.py"
        parent_module: "app_calculation"
        description: "–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è calculate() + helpers: _compute_duty (lt3: percent+min, 3_5/gt5: rate per cc), _utilization_fee_v2 (2D —Ç–∞–±–ª–∏—Ü–∞ –æ–±—ä—ë–º+–º–æ—â–Ω–æ—Å—Ç—å –≤ –∫–í—Ç, M1 only), _commission (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 1000 USD + –ø–æ —Å—Ç—Ä–∞–Ω–∞–º, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ effective_rate –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π bank_commission), _select_freight, _japan_country_expenses (—Ç–∏—ã—Ä—ã –≤ JPY), _other_country_expenses, _convert/_convert_from_rub, _currency_rate, _effective_currency_rate, _get_bank_commission_percent; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Decimal –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏. –í–Ω—É—Ç—Ä–∏ calculate() —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è breakdown –∏ CalculationMeta, –≤–∫–ª—é—á–∞—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ meta.rates_used (—á–∏—Å–ª–æ–≤—ã–µ –∫—É—Ä—Å—ã XXX_RUB) –∏ meta.detailed_rates_used (RateUsage —Å base/effective/percent/display)."
      - name: "models.py"
        parent_module: "app_calculation"
        description: "Pydantic v2 –º–æ–¥–µ–ª–∏: CalculationRequest (–≤–∞–ª–∏–¥–∞—Ü–∏—è year 1990-current, engine_power_hp 1-1500, normalize currency), CostBreakdown (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ RUB), CalculationMeta (age_category, duty_mode, vehicle_type, engine_power_hp/kw, utilization_coefficient, warnings, rates_used: dict[str, float] –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∫—É—Ä—Å–æ–≤, detailed_rates_used: dict[str, RateUsage] –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –∫—É—Ä—Å–æ–≤ —Å base_rate/effective_rate/bank_commission_percent/display), CalculationResult; Literal —Ç–∏–ø—ã: Country ['japan', 'korea', 'uae', 'china', 'georgia'], FreightType, VehicleType; WarningItem"
      - name: "rounding.py"
        parent_module: "app_calculation"
        description: "–§—É–Ω–∫—Ü–∏–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏ Decimal-—É—Ç–∏–ª–∏—Ç—ã"
      - name: "tariff_tables.py"
        parent_module: "app_calculation"
        description: "–§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫ –ø–æ—à–ª–∏–Ω—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–π/–¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤"

      - name: "cbr.py"
        parent_module: "app_services"
        description: "CBRRatesService (thread-safe —Å Lock, CacheEntry, TTL –ø—Ä–æ–≤–µ—Ä–∫–∞), parse_cbr_xml (ET –ø–∞—Ä—Å–∏–Ω–≥ VunitRate –¥–ª—è USD/EUR/JPY/CNY/AED), _do_fetch (httpx + @retry/tenacity), get_effective_rates (—Å–ª–∏—è–Ω–∏–µ static+live), fetch_rates (force –æ–ø—Ü–∏—è, pytest guard)"

      - name: "routes.py"
        parent_module: "app_api"
        description: "APIRouter /api: GET /health (config_hash, cbr_cache, eur_rate), POST /calculate (–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic), GET /rates (currencies, commissions, utilization, duties, japan_expense_tiers, countries_active, live_source), POST /rates/refresh (force CBR), GET /meta (countries —Å labels –∏ emoji –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UI, freight_types, age_categories, constraints, currencies_supported)"

      - name: "main.py"
        parent_module: "app_main"
        description: "–°–æ–∑–¥–∞–Ω–∏–µ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, CORS, rate-limit, —Å—Ç–∞—Ç–∏–∫–∞, /, /manifest.json, /sw.js, /ping, /debug/files"
      - name: "struct_logger.py"
        parent_module: "app_main"
        description: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ structured logging (structlog), –≥–ª–æ–±–∞–ª—å–Ω—ã–π logger"

      - name: "main.py"
        parent_module: "app_bot"
        description: "_build_bot (TOKEN_PATTERN regex –≤–∞–ª–∏–¥–∞—Ü–∏—è, DefaultBotProperties(ParseMode.HTML)), _build_dispatcher (register handlers), _set_commands (BotCommand /start), main_async (setup_logging, TelegramNotFound –æ–±—Ä–∞–±–æ—Ç–∫–∞, dp.start_polling —Å allowed_updates), run_bot entrypoint; Custom exceptions: MissingBotTokenError, InvalidBotTokenError"
      - name: "handlers/start.py"
        parent_module: "app_bot"
        description: "Router: @router.message(Command('start')) ‚Üí cmd_start (–ø—Ä–æ–≤–µ—Ä–∫–∞ HTTPS –¥–ª—è WebApp button, main_menu –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞), @router.message(Command('calc')) ‚Üí cmd_calc (–ø—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ japan 2021 1496cc 110hp —Å _format_result), @router.message(F.web_app_data) ‚Üí on_webapp_data (–ø–∞—Ä—Å–∏–Ω–≥ JSON —Å engine_power_hp, –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤—ã–∑–æ–≤ calculate, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ _format_result —Å –º–æ—â–Ω–æ—Å—Ç—å—é –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —É—Ç–∏–ª—å—Å–±–æ—Ä–∞); _format_result helper (HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å breakdown, –º–æ—â–Ω–æ—Å—Ç—å—é –≤ –∫–í—Ç, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —É—Ç–∏–ª—å—Å–±–æ—Ä–∞); register(dp: Dispatcher)"
      - name: "handlers/config.py"
        parent_module: "app_bot_config"
        description: "–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞–º–∏: ConfigFile enum (FEES/COMMISSIONS/RATES/DUTIES), CONFIG_METADATA —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏ required_keys, ConfigUploadStates (FSM –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤), helper-—Ñ—É–Ω–∫—Ü–∏–∏ get_config_path() –∏ get_backup_path() —Å UTC timestamp, Router 'config_handlers'. SPRINT CONFIG-01: –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞. SPRINT CONFIG-02 (COMPLETED 2025-12-28): –∫–æ–º–∞–Ω–¥—ã —Å–∫–∞—á–∏–≤–∞–Ω–∏—è /get_fees, /get_commissions, /get_rates, /get_duties, /list_configs; send_config_file() (FSInputFile, caption —Å —Ä–∞–∑–º–µ—Ä–æ–º, 404 handling), format_config_list() (—Å—Ç–∞—Ç—É—Å ‚úÖ/‚ùå). –¢–µ—Å—Ç—ã: test_config_download.py (11 tests, 92% coverage). –°–ª–µ–¥—É—é—â–∏–π: CONFIG-03 (upload commands with FSM)."
      - name: "keyboards.py"
        parent_module: "app_bot"
        description: "ReplyKeyboard —Å WebApp-–∫–Ω–æ–ø–∫–æ–π"

      - name: "messages.js"
        parent_module: "app_webapp"
        description: "Single source of truth –¥–ª—è –≤—Å–µ—Ö UI —Ç–µ–∫—Å—Ç–æ–≤: errors (–≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–µ—Ç—å, enginePowerHpRequired), buttons (labels), labels (–ø–æ–ª—è —Ñ–æ—Ä–º—ã, ENGINE_POWER_HP), breakdown (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏, ENGINE_POWER_KW, UTILIZATION_COEFFICIENT), info (toast —Å–æ–æ–±—â–µ–Ω–∏—è), warnings (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è), share (—à–∞–±–ª–æ–Ω—ã –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞), age (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤–æ–∑—Ä–∞—Å—Ç–∞), freight/vehicle/countries/currencies (fallback labels)"
      - name: "constants.js"
        parent_module: "app_webapp"
        description: "–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: Constraints (YEAR_MIN=1990, YEAR_MAX, ENGINE_CC_MIN=500, ENGINE_CC_MAX=10000, ENGINE_POWER_HP_MIN=1, ENGINE_POWER_HP_MAX=1500 - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å models.py), CONVERSION_FACTORS (HP_TO_KW=0.7355, KW_TO_HP=1.35962), API_ENDPOINTS, API_CONFIG (retry, timeout, payload limits), DEFAULT_VALUES (COUNTRY='japan', ENGINE_CC=1500, YEAR_OFFSET=3), COUNTRY_EMOJI (fruit emojis), FALLBACK_META, HAPTIC_TYPES, TOAST_CONFIG, ANIMATION, DEBOUNCE, form/result element IDs"
      - name: "validator.js"
        parent_module: "app_webapp"
        description: "–ú–æ–¥—É–ª—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º: FormValidator –∫–ª–∞—Å—Å (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–∏–ª –≤–∞–ª–∏–¥–∞—Ü–∏–∏), –º–µ—Ç–æ–¥—ã: validate(formData) ‚Üí {isValid, errors[]}, validateField(name, value) ‚Üí error|null (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ year, engine_cc, engine_power_hp, purchase_price, country), getFieldConstraints(name) ‚Üí {min, max, step, required, type}, addCustomValidator(fieldName, fn), removeCustomValidator(), clearCustomValidators; –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏; —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å backend Pydantic –º–æ–¥–µ–ª—è–º–∏"
      - name: "api.js"
        parent_module: "app_webapp"
        description: "–ú–æ–¥—É–ª—å HTTP –∫–ª–∏–µ–Ω—Ç–∞: APIClient –∫–ª–∞—Å—Å (singleton), –º–µ—Ç–æ–¥—ã: calculate/getMeta/getRates/refreshRates (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è API), _request (–±–∞–∑–æ–≤—ã–π HTTP —Å retry, timeout, payload size check), _handleError (–º–∞–ø–ø–∏–Ω–≥ HTTP —Å—Ç–∞—Ç—É—Å–æ–≤); APIError –∫–ª–∞—Å—Å (code, httpStatus, getUserMessage, toLogFormat); –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: MAX_RETRIES=3, REQUEST_TIMEOUT=10s, MAX_PAYLOAD_SIZE=10MB"
      - name: "ui.js"
        parent_module: "app_webapp"
        description: "–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏: UI –∫–ª–∞—Å—Å (singleton), state management (_state: idle/loading/error/success, getState, _setState), –º–µ—Ç–æ–¥—ã: showLoading(text)/hideLoading, showError(msg)/hideError, showResult/hideResult, showShareButton/hideShareButton, scrollToResult, disableForm/enableForm, reset, showToast(message, type, duration); –∞–Ω–∏–º–∞—Ü–∏–∏: _fadeIn/_fadeOut (CSS transitions), _hapticFeedback (Telegram); accessibility: ARIA attributes (role, aria-live, aria-busy), focus management"
      - name: "hints.js"
        parent_module: "app_webapp_hints"
        description: "–ú–æ–¥—É–ª—å –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π (MVP): HintsManager –∫–ª–∞—Å—Å (constructor(constants, messages)), –º–µ—Ç–æ–¥—ã: getAgeHintData(year) ‚Üí {zone, className, text, ariaLabel} (—Ä–∞—Å—á–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω—ã: optimal 3-5 –ª–µ—Ç, prohibitive <3, warning >5), getPowerHintData(powerHp) ‚Üí hint data (–∑–æ–Ω—ã –ø–æ –º–æ—â–Ω–æ—Å—Ç–∏: optimal ‚â§160, acceptable 160-200, warning 200-300, prohibitive >300), applyHintToField(fieldElement, hintData) (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ CSS –∫–ª–∞—Å—Å–æ–≤ –∏ ARIA –∞—Ç—Ä–∏–±—É—Ç–æ–≤), showHintText(fieldElement, text) (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–¥ –ø–æ–ª–µ–º), hideHintText(fieldElement), _createTooltip(tooltipText, iconElement) (–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º viewport), showTooltip/hideTooltip (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ tooltip'–∞–º–∏), initTooltips() (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ ‚ÑπÔ∏è –∏–∫–æ–Ω–æ–∫ –∫ labels –ø–æ–ª–µ–π year –∏ enginePowerHp), attachFieldHints(fieldElement, fieldType) (debounced input handler 300ms), init() (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è year –∏ enginePowerHp), destroy() (cleanup); activeTooltips Map –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è; debounce —É—Ç–∏–ª–∏—Ç–∞; real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, keyboard support (Enter/Space), click/hover events, auto-hide —á–µ—Ä–µ–∑ 5 —Å–µ–∫"
      - name: "hints.css"
        parent_module: "app_webapp_hints"
        description: "–°—Ç–∏–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫: —Ü–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π (.input-hint-optimal green, .input-hint-acceptable blue, .input-hint-warning orange, .input-hint-prohibitive red —Å border 2px, background rgba, transitions 0.3s, focus states —Å box-shadow), .hint-text (–ø–æ–¥ –ø–æ–ª–µ–º, font-size 13px, fadeIn animation 0.2s, —Ü–≤–µ—Ç–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã), .info-icon (‚ÑπÔ∏è inline-flex 18x18px, hover scale 1.15, :focus outline, ::after –¥–ª—è tap area 44x44px), .hint-tooltip (absolute, max-width 280px, padding 10px, border-radius 8px, box-shadow, ::before —Å—Ç—Ä–µ–ª–∫–∞, .tooltip-bottom/.tooltip-top –ø–æ–∑–∏—Ü–∏–∏), .has-info-icon label (display inline-flex), mobile adaptations (@media max-width 480px), dark mode (@media prefers-color-scheme dark), high contrast (@media prefers-contrast high), print styles (hide hints)"

      - name: "fees.yml"
        parent_module: "config_data"
        description: "–°—Ç—Ä–∞–Ω—ã, –≤–∞–ª—é—Ç–∞ –ø–æ–∫—É–ø–∫–∏, —Ñ—Ä–∞—Ö—Ç, –±–∞–∑–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã/—Ç–∏–µ—Ä—ã"
      - name: "commissions.yml"
        parent_module: "config_data"
        description: "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (default_commission_usd: 1000, by_country.uae.commission_usd: 0) –∏ —Å–µ–∫—Ü–∏—è bank_commission: enabled, percent (0‚Äì10% —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω), meta.recommended_min/max, warn_above, default_percent. –í —Ä–∞–Ω—Ç–∞–π–º–µ –¥–≤–∏–∂–æ–∫ —á–∏—Ç–∞–µ—Ç percent –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ–≥–æ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫—É –∫ –≤–∞–ª—é—Ç–Ω—ã–º –∫—É—Ä—Å–∞–º –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ purchase_price, freight, country_expenses –∏ –∫–æ–º–∏—Å—Å–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏. –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É YAML-–∫–æ–Ω—Ñ–∏–≥–∏ –≤ tests/test_data/config (commissions_company_only.yml ‚Äî –±–µ–∑ bank_commission, commissions_with_bank.yml ‚Äî —Å –≤–∫–ª—é—á—ë–Ω–Ω–æ–π bank_commission)."
      - name: "rates.yml"
        parent_module: "config_data"
        description: "–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã, —É—Ç–∏–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–±–æ—Ä (utilization_m1_personal: 2D-—Ç–∞–±–ª–∏—Ü–∞ –æ–±—ä—ë–º+–º–æ—â–Ω–æ—Å—Ç—å, 80+ –∑–∞–ø–∏—Å–µ–π), –≠–†–ê-–ì–õ–û–ù–ê–°–° (era_glonass_rub: 45000), –ø—Ä–æ—á–∏–µ —Å—Ç–∞–≤–∫–∏"
      - name: "duties.yml"
        parent_module: "config_data"
        description: "–ü–æ—à–ª–∏–Ω—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –æ–±—ä—ë–º—É; –±—Ä—ç–∫–µ—Ç –¥–ª—è <3 –ª–µ—Ç"

      - name: "functional/test_api.py"
        parent_module: "tests"
        description: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ /api/rates, /api/meta, /api/calculate"
      - name: "functional/test_engine.py"
        parent_module: "tests"
        description: "–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ e2e-–∫–µ–π—Å—ã —Ä–∞—Å—á—ë—Ç–∞ —á–µ—Ä–µ–∑ API –ø–æ cases.yml"
      - name: "functional/test_cbr.py"
        parent_module: "tests"
        description: "–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç –ø–∞—Ä—Å–µ—Ä–∞ CBR XML –∏ get_effective_rates (monkeypatch)"
      - name: "conftest.py"
        parent_module: "tests"
        description: "–§–∏–∫—Å—Ç—É—Ä–∞ TestClient(app) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã.

          –í —Ç.—á. _ensure_test_commissions_defaults: –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –ø–æ–¥–º–µ–Ω—è–ª–∞ cfg.commissions
          legacy-—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ø–æ—Ä–æ–≥–æ–≤ (thresholds). –í —Ä–∞–º–∫–∞—Ö –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ v2-—Å—Ö–µ–º—É –∫–æ–º–∏—Å—Å–∏–π
          –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ YAML-–∫–æ–Ω—Ñ–∏–≥–∞ commissions_company_only.yml,
          —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ —Å config/commissions.yml (default_commission_usd/by_country –∏ –±–µ–∑
          —Å–µ–∫—Ü–∏–∏ bank_commission). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç
          –≤ –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å commissions_with_bank.yml –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
          bank_commission_runtime_support –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –±–æ–µ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥."

    components:
      - name: "AppSettings"
        parent_file: "settings.py"
        type: "class"
        description: "–ó–∞–≥—Ä—É–∑–∫–∞ ENV, —Ñ–ª–∞–≥–∏ (ENABLE_LIVE_CBR –∏ –¥—Ä.), –¥–µ—Ä–∏–≤–∞—Ç–∏–≤—ã (webapp_url, countries_list)"
        testable: true
        test_priority: "medium"

      - name: "ConfigRegistry.load"
        parent_file: "settings.py"
        type: "function"
        description: "–ß—Ç–µ–Ω–∏–µ YAML-–∫–æ–Ω—Ñ–∏–≥–æ–≤, —Ö—ç—à –∏ –º–µ—Ç–∞-–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏"
        testable: true
        test_priority: "medium"

      - name: "get_settings / get_configs"
        parent_file: "settings.py"
        type: "function"
        description: "–ö–µ—à–∏—Ä—É–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤"
        testable: true
        test_priority: "medium"

      - name: "CalculationRequest"
        parent_file: "models.py"
        type: "class"
        description: "–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞ (–≥–æ–¥, –≤–∞–ª—é—Ç–∞, —Ç–∏–ø—ã), –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è currency"
        testable: true
        test_priority: "high"

      - name: "CostBreakdown"
        parent_file: "models.py"
        type: "class"
        description: "–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–µ–π –≤ RUB"
        testable: true
        test_priority: "medium"

      - name: "CalculationMeta"
        parent_file: "models.py"
        type: "class"
        description: "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç–∞: –≤–æ–∑—Ä–∞—Å—Ç/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—Å—Ç–∞–≤–∫–∏/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã. –í –±—É–¥—É—â–µ–º (—Å–º. SPRINT 1) –ø–æ–ª–µ rates_used –¥–æ–ª–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã base_rate, bank_commission_percent –∏ effective_rate –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤–∏–¥–∞ 'BASE_RATE [+ X%]'."
        testable: true
        test_priority: "medium"

      - name: "CalculationResult"
        parent_file: "models.py"
        type: "class"
        description: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞ (breakdown, meta, warnings)"
        testable: true
        test_priority: "low"

      - name: "WarningItem"
        parent_file: "models.py"
        type: "class"
        description: "–ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: code (SANCTIONS_UNKNOWN, JAPAN_CURRENCY, NO_DUTY, NON_M1), message"
        testable: true
        test_priority: "low"

      - name: "CalculationError"
        parent_file: "engine.py"
        type: "class"
        description: "Domain exception –¥–ª—è –æ—à–∏–±–æ–∫ —Ä–∞—Å—á—ë—Ç–∞ (missing_currency_rate classmethod)"
        testable: true
        test_priority: "medium"

      - name: "calculate"
        parent_file: "engine.py"
        type: "function"
        description: "–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞: get_effective_rates, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è purchase_price, _compute_duty, _utilization_fee (—Ç–æ–ª—å–∫–æ M1), customs_services, —Ñ—Ä–∞—Ö—Ç, country_expenses, –∫–æ–º–∏—Å—Å–∏—è, –∏—Ç–æ–≥–æ; tracking used_currency_codes –¥–ª—è meta.rates_used; warnings: SANCTIONS_UNKNOWN, NON_M1"
        testable: true
        test_priority: "high"

      - name: "_compute_duty"
        parent_file: "engine.py"
        type: "function"
        description: "–†–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã: <3 –ª–µ—Ç –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (EUR), 3-5/>5 –ø–æ —Å—Ç–∞–≤–∫–µ ‚Ç¨/—Å–º¬≥"
        testable: true
        test_priority: "medium"

      - name: "_utilization_fee"
        parent_file: "engine.py"
        type: "function"
        description: "DEPRECATED: –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ (—Ç–æ–ª—å–∫–æ –ø–æ –æ–±—ä—ë–º—É), –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ _utilization_fee_v2"
        testable: true
        test_priority: "low"

      - name: "_utilization_fee_v2"
        parent_file: "engine.py"
        type: "function"
        description: "–†–∞—Å—á—ë—Ç —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ –ø–æ 2D-—Ç–∞–±–ª–∏—Ü–µ (–æ–±—ä—ë–º+–º–æ—â–Ω–æ—Å—Ç—å): –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ª.—Å.‚Üí–∫–í—Ç (√ó0.7355), –ø–æ–∏—Å–∫ volume_band (5 bands), –ø–æ–∏—Å–∫ power_bracket –ø–æ power_kw, –≤—ã–±–æ—Ä –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ (lt3/gt3), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (fee_rub, coefficient). –í—Ö–æ–¥—ã: engine_cc, engine_power_hp, vehicle_age_years. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç config/rates.yml:utilization_m1_personal"
        testable: true
        test_priority: "high"

      - name: "_commission"
        parent_file: "engine.py"
        type: "function"
        description: "–ö–æ–º–∏—Å—Å–∏—è –ø–æ –ø–æ—Ä–æ–≥–∞–º –æ—Ç —Ü–µ–Ω—ã –ø–æ–∫—É–ø–∫–∏ –≤ RUB; –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç per-country override (by_country)"
        testable: true
        test_priority: "medium"

      - name: "_convert_from_rub"
        parent_file: "engine.py"
        type: "function"
        description: "–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RUB ‚Üí —Ü–µ–ª–µ–≤—É—é –≤–∞–ª—é—Ç—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ Japan tiers –≤ JPY)"
        testable: true
        test_priority: "low"

      - name: "_currency_rate"
        parent_file: "engine.py"
        type: "function"
        description: "–ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ {CODE}_RUB –∏–∑ rates_conf, raises CalculationError –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
        testable: true
        test_priority: "high"

      - name: "_select_freight"
        parent_file: "engine.py"
        type: "function"
        description: "–í—ã–±–æ—Ä —Ñ—Ä–∞—Ö—Ç–∞ (—Ç–∏–ø+–≤–∞–ª—é—Ç–∞) —Å –∫–æ–Ω—Ñ–∏–≥‚Äë–¥–µ—Ñ–æ–ª—Ç–æ–º"
        testable: true
        test_priority: "low"

      - name: "_japan_country_expenses / _other_country_expenses"
        parent_file: "engine.py"
        type: "function"
        description: "–°—Ç—Ä–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: –Ø–ø–æ–Ω–∏—è –ø–æ —Ç–∏—Ä—É —Ü–µ–Ω—ã (–≤ JPY), –ø—Ä–æ—á–∏–µ ‚Äî —Å—É–º–º–∞ –±–∞–∑–æ–≤—ã—Ö"
        testable: true
        test_priority: "low"

      - name: "get_age_category / get_passing_category"
        parent_file: "tariff_tables.py"
        type: "function"
        description: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∏ ¬´–ø—Ä–æ—Ö–æ–¥–Ω–æ–π¬ª –∫–∞—Ç–µ–≥–æ—Ä–∏–π"
        testable: true
        test_priority: "medium"

      - name: "find_duty_rate / find_lt3_value_bracket / format_volume_band"
        parent_file: "tariff_tables.py"
        type: "function"
        description: "–ü–æ–∏—Å–∫ —Å—Ç–∞–≤–∫–∏ –ø–æ—à–ª–∏–Ω—ã/–±—Ä—ç–∫–µ—Ç–æ–≤ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤"
        testable: true
        test_priority: "medium"

      - name: "to_decimal / quantize4 / round_rub"
        parent_file: "rounding.py"
        type: "function"
        description: "–ß–∏—Å–ª–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –¥–µ–Ω–µ–∂–Ω–æ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ (RUB)"
        testable: true
        test_priority: "medium"

      - name: "CBRRatesService"
        parent_file: "cbr.py"
        type: "class"
        description: "–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–µ—Ä–≤–∏—Å: _cache (CacheEntry | None), _lock (threading.Lock), _parse_xml, _is_cache_valid, @retry _do_fetch (httpx.get + parse), fetch_rates (TTL check, pytest guard, force override)"
        testable: true
        test_priority: "high"

      - name: "parse_cbr_xml"
        parent_file: "cbr.py"
        type: "function"
        description: "–ü–∞—Ä—Å–∏–Ω–≥ XML CBR (ET.fromstring): –∏—â–µ—Ç Valute/CharCode+VunitRate, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ _load_currency_codes, –∑–∞–º–µ–Ω—è–µ—Ç –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {CODE_RUB: float}"
        testable: true
        test_priority: "high"

      - name: "get_effective_rates"
        parent_file: "cbr.py"
        type: "function"
        description: "–°–ª–∏—è–Ω–∏–µ static rates —Å cbr_service.fetch_rates() (–µ—Å–ª–∏ enable_live_cbr=true); –∫–æ–ø–∏—Ä—É–µ—Ç base_conf, –æ–±–Ω–æ–≤–ª—è–µ—Ç currencies, –¥–æ–±–∞–≤–ª—è–µ—Ç live_source='cbr' –∏–ª–∏ None"
        testable: true
        test_priority: "high"

      - name: "fetch_cbr_rates"
        parent_file: "cbr.py"
        type: "function"
        description: "Alias –¥–ª—è cbr_service.fetch_rates() ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–∞—Ö –¥–ª—è monkeypatch"
        testable: true
        test_priority: "medium"

      - name: "cbr_service"
        parent_file: "cbr.py"
        type: "global"
        description: "Singleton –∏–Ω—Å—Ç–∞–Ω—Å CBRRatesService –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cache"
        testable: false
        test_priority: "n/a"

      - name: "CacheEntry"
        parent_file: "cbr.py"
        type: "class"
        description: "NamedTuple: rates (dict[str, float]), fetched_at (float timestamp)"
        testable: false
        test_priority: "n/a"

      - name: "CBRFetchError"
        parent_file: "cbr.py"
        type: "class"
        description: "Exception –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö fetch/parse CBR XML"
        testable: false
        test_priority: "n/a"

      - name: "calculate_endpoint"
        parent_file: "routes.py"
        type: "function"
        description: "POST /api/calculate ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ pydantic –∏ –≤—ã–∑–æ–≤ calculate"
        testable: true
        test_priority: "high"

      - name: "get_rates / get_meta / health / refresh_rates"
        parent_file: "routes.py"
        type: "function"
        description: "–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–¥–æ—Ä–æ–≤—å—è, —Ñ–æ—Ä—Å‚Äë–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤"
        testable: true
        test_priority: "high"

      - name: "create_app / rate_limit_middleware / lifespan"
        parent_file: "main.py"
        type: "function"
        description: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI, CORS, rate limit, —Å—Ç–∞—Ç–∏–∫–∞ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã"
        testable: true
        test_priority: "medium"

      - name: "setup_logging / logger"
        parent_file: "struct_logger.py"
        type: "function"
        description: "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è structlog –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä"
        testable: true
        test_priority: "low"

      - name: "_build_bot / _build_dispatcher / _set_commands / main_async / run_bot"
        parent_file: "app/bot/main.py"
        type: "function"
        description: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞), —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤, polling"
        testable: true
        test_priority: "medium"

      - name: "cmd_start / cmd_calc / on_webapp_data / _format_result / register"
        parent_file: "app/bot/handlers/start.py"
        type: "function"
        description: "–•–µ–Ω–¥–ª–µ—Ä—ã aiogram (NEW: cmd_calc —Å engine_power_hp=110, on_webapp_data —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π engine_power_hp, –æ–±—Ä–∞–±–æ—Ç–∫–æ–π ValidationError), _format_result helper (HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –º–æ—â–Ω–æ—Å—Ç—å—é –≤ –∫–í—Ç, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —É—Ç–∏–ª—å—Å–±–æ—Ä–∞, breakdown, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏), –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–≤–∏–∂–∫–æ–º —Ä–∞—Å—á—ë—Ç–∞"
        testable: true
        test_priority: "high"

      - name: "main_menu"
        parent_file: "app/bot/keyboards.py"
        type: "function"
        description: "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å WebApp-–∫–Ω–æ–ø–∫–æ–π"
        testable: true
        test_priority: "low"

      - name: "FormValidator"
        parent_file: "validator.js"
        type: "class"
        description: "–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞: validate(formData) ‚Üí {isValid, errors[]}, validateField(fieldName, value) ‚Üí error|null, getFieldConstraints(fieldName) ‚Üí {min, max, step, required}, addCustomValidator/removeCustomValidator/clearCustomValidators; —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å backend Pydantic –º–æ–¥–µ–ª—è–º–∏; real-time –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ"
        testable: true
        test_priority: "high"

      - name: "APIClient"
        parent_file: "api.js"
        type: "class"
        description: "HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API: calculate(requestData), getMeta(), getRates(), refreshRates(force); –≤–Ω—É—Ç—Ä–∏: _request(method, endpoint, data, options) —Å retry (max 3), timeout (10s), payload size check (10MB), _handleError —Å –º–∞–ø–ø–∏–Ω–≥–æ–º HTTP —Å—Ç–∞—Ç—É—Å–æ–≤ ‚Üí APIError; singleton pattern"
        testable: true
        test_priority: "high"

      - name: "APIError"
        parent_file: "api.js"
        type: "class"
        description: "–ö–∞—Å—Ç–æ–º–Ω–∞—è –æ—à–∏–±–∫–∞ API: code (enum: NETWORK_ERROR, TIMEOUT, VALIDATION_ERROR, etc.), httpStatus, originalError, getUserMessage() ‚Üí user-friendly —Ç–µ–∫—Å—Ç, toLogFormat() ‚Üí –¥–µ—Ç–∞–ª–∏ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫"
        testable: true
        test_priority: "medium"

      - name: "UI"
        parent_file: "ui.js"
        type: "class"
        description: "–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏: state management (_state: idle/loading/error/success, getState(), _setState()), –º–µ—Ç–æ–¥—ã –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è: showLoading(text)/hideLoading, showError(msg)/hideError, showResult/hideResult, showShareButton/hideShareButton, scrollToResult (smooth scroll), disableForm/enableForm, reset; showToast(message, type, duration) –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π; –∞–Ω–∏–º–∞—Ü–∏–∏: _fadeIn/_fadeOut (CSS transitions); Telegram haptic feedback (_hapticFeedback); accessibility: ARIA attributes (role, aria-live, aria-busy), focus management; singleton pattern"
        testable: true
        test_priority: "high"

  tests:
    test_status:
      overall: "619 tests (618 passed, 1 skipped) | 91% coverage | SPRINT TEST-01 to TEST-07 COMPLETED 2025-12-16"
      functional_tests: "142 tests - test_api.py (40), test_api_validation.py (51), test_api_bank_commission.py (3), test_engine.py (46), test_cbr.py (2)"
      unit_tests: "477 tests - models (148), rounding (69), tariff_tables (117), engine helpers (63), engine integration (22), utilization_v2 (19), bank_commission (37), rates_used (2)"
      api_tests: "91 tests (test_api.py + test_api_validation.py) - comprehensive coverage of all endpoints with validation, invariants, and boundary cases"
      parametrized_tests: "46 parametrized test cases in test_engine.py - comprehensive boundary coverage (cases.yml v2.0.0)"
      coverage: "91% overall | models 100%, tariff_tables 100%, routes 99%, rounding 95%, engine 94%, settings 93%, cbr 85%"
      coverage_by_module:
        models: "100% (79 stmts, 0 miss)"
        tariff_tables: "100% (40 stmts, 0 miss)"
        routes: "99% (67 stmts, 1 miss)"
        rounding: "95% (22 stmts, 1 miss)"
        engine: "94% (235 stmts, 13 miss)"
        settings: "93% (71 stmts, 5 miss)"
        cbr: "85% (110 stmts, 16 miss)"
        main: "67% (87 stmts, 29 miss - infrastructure layer)"
      gaps_closed: "All HIGH priority gaps CLOSED ‚úÖ | 2 MEDIUM gaps remaining (static files, utilization fallback) | 2 LOW gaps deferred (middleware, bot)"
      test_quality:
        isolation: "‚úÖ fixtures for configs, no external deps in unit tests"
        determinism: "‚úÖ fixed dates, fixed rates, reproducible results"
        clarity: "‚úÖ descriptive names, docstrings, parametrization with ids"
        completeness: "‚úÖ happy/sad/boundary/edge/invariants covered"
      last_audit: "2025-12-16"
      last_updated: "2025-12-16 (SPRINT TEST-07 FINAL)"

    test_data:
      cases_yml:
        location: "tests/test_data/cases.yml"
        version: "2.0.0"
        total_cases: 46
        description: "–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–≤–∏–∂–∫–∞ —Ä–∞—Å—á—ë—Ç–∞"
        last_updated: "2025-12-16"
        coverage:
          countries: ["japan", "korea", "uae", "china", "georgia"]
          age_categories: ["lt3", "3_5", "gt5"]
          power_ranges: ["low (1-100)", "medium (100-200)", "high (200-400)", "extreme (400-1500)"]
          duty_modes: ["lt3_min", "lt3_percent", "fixed_rate"]
          boundary_tests:
            age: ["exact 3 years", "exact 5 years", "2 years", "6 years"]
            cc: ["1000", "1001", "1500", "1501", "1800", "1801", "2300", "2301", "3000", "3001"]
            eur_value: ["8499", "8500", "16700", "42300", "84500", "169000", "169001"]
          special_scenarios:
            - "Japan sanctioned/non-sanctioned freight (2000 USD vs 350 USD)"
            - "UAE open/container transport (2500 USD vs 3800 USD)"
            - "Extreme power (1 hp and 1500 hp)"
            - "Extreme cc (500 and 10000)"
            - "Year boundaries (1990 and 2025)"
            - "High precision price (9999.99 EUR)"
            - "Rounding checks (fractional cc values)"
        maintenance:
          update_script: "scripts/update_test_expectations.py"
          note: "Expected values are auto-generated from API responses using test configuration (static rates, test commissions)"

      fixtures:
        - file: "tests/test_data/fixtures/rates_static.yml"
          description: "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤ (USD_RUB=90, EUR_RUB=100, JPY_RUB=0.6, CNY_RUB=12.5, AED_RUB=24.5)"
          usage: "Reference for expected value calculations"
        - file: "tests/test_data/fixtures/duties_sample.yml"
          description: "–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—à–ª–∏–Ω –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤"
          usage: "Isolated test data (not dependent on config/duties.yml)"

      config:
        - file: "tests/test_data/config/commissions_company_only.yml"
          description: "–ö–æ–º–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –±–µ–∑ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)"
          loaded_by: "tests/conftest.py (_ensure_test_commissions_defaults fixture)"
        - file: "tests/test_data/config/commissions_with_bank.yml"
          description: "–ö–æ–º–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ + –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è 2% (–¥–ª—è —Ç–µ—Å—Ç–æ–≤ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏)"
          usage: "Specific tests for bank commission functionality"

    unit_tests:
      # ===== EXISTING TESTS (v2.0.0) =====
      - target_component: "_utilization_fee_v2"
        test_file: "tests/unit/test_utilization_v2.py"
        test_functions: ["test_utilization_fee_calculation (11 parametrized cases)", "test_utilization_fee_hp_to_kw_conversion", "test_utilization_fee_edge_case_boundary", "test_utilization_fee_zero_power", "test_utilization_fee_all_age_categories", "test_utilization_fee_different_countries", "test_utilization_fee_high_power_vehicle", "test_utilization_fee_low_power_vehicle"]
        coverage_status: "exists"
        notes: "SPRINT 8: –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ 2025 - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ª.—Å.‚Üí–∫–í—Ç (0.7355), –≤—Å–µ 5 –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –æ–±—ä—ë–º–∞ (‚â§1000, 1001-2000, 2001-3000, 3001-3500, >3500 cc), –≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (lt3, 3_5, gt5), –≥—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (0hp, 1hp, 400hp), boundary cases –º–µ–∂–¥—É –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏. Coverage ~95%"

      - target_component: "_get_bank_commission_percent, _effective_currency_rate"
        test_file: "tests/unit/test_bank_commission.py"
        test_functions: ["test_get_bank_commission_percent_missing_section_returns_zero", "test_get_bank_commission_percent_disabled_returns_zero", "test_get_bank_commission_percent_uses_default_when_percent_missing", "test_get_bank_commission_percent_falls_back_to_zero_on_bad_default", "test_get_bank_commission_percent_uses_explicit_percent", "test_effective_currency_rate_zero_percent_equals_base_rate", "test_effective_currency_rate_positive_percent_increases_rate", "test_effective_currency_rate_handles_lowercase_currency_code", "test_total_rub_is_monotonic_with_respect_to_bank_commission"]
        coverage_status: "exists"
        notes: "SPRINT 4.5-4.7: –ü–æ–∫—Ä—ã—Ç–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ - —á—Ç–µ–Ω–∏–µ config/commissions.yml::bank_commission, —Ä–∞—Å—á—ë—Ç effective_rate, –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç–∏ total_rub"

      - target_component: "CalculationMeta.rates_used, detailed_rates_used"
        test_file: "tests/unit/test_rates_used_meta.py"
        test_functions: ["test_detailed_rates_used_and_meta_rates_used_display_no_commission", "test_detailed_rates_used_display_with_positive_commission"]
        coverage_status: "exists"
        notes: "SPRINT 4.5-4.7: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ display —Å—Ç—Ä–æ–∫ ('USD/RUB = 90.0' vs 'USD/RUB = 90.0 + 2%') –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö"

      - target_component: "parse_cbr_xml"
        test_file: "tests/functional/test_cbr.py"
        test_functions: ["test_parse_cbr_xml_basic"]
        coverage_status: "exists"
        notes: "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ sample XML —Å USD/EUR/JPY/CNY/AED"

      - target_component: "get_effective_rates"
        test_file: "tests/functional/test_cbr.py"
        test_functions: ["test_get_effective_rates_monkeypatch"]
        coverage_status: "exists"
        notes: "Monkeypatch fake_fetch, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ª–∏—è–Ω–∏–µ —Å base rates"

      # ===== GAPS IDENTIFIED (TEST AUDIT 2025-12-16) =====
      # HIGH PRIORITY (Critical - –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–æ–≤)

      # SPRINT TEST-02 COMPLETED (2025-12-16) - Models validation and structure
      - target_component: "CalculationRequest (all fields and validators)"
        test_file: "tests/unit/test_models_validation.py"
        test_functions: ["TestYearValidation (10 tests)", "TestEngineCcValidation (7 tests)", "TestEnginePowerHpValidation (7 tests)", "TestPurchasePriceValidation (7 tests)", "TestCurrencyValidation (5 tests)", "TestCountryValidation (5 tests)", "TestFreightTypeValidation (6 tests)", "TestVehicleTypeValidation (3 tests)", "TestSanctionsUnknownValidation (3 tests)"]
        coverage_status: "exists"
        priority: "HIGH"
        notes: "101 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –ø–æ–ª—è CalculationRequest: year (1990-current), engine_cc (1-10000), engine_power_hp (1-1500, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ), purchase_price (>0), currency (RUB/USD/EUR/JPY/CNY/AED —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π), country (japan/korea/uae/china/georgia), freight_type (standard/open/container), vehicle_type (M1/pickup/bus/motorhome/other), sanctions_unknown (bool). –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã: validate_year (ERR_YEAR_FUTURE, ERR_YEAR_TOO_OLD), normalize_currency (upper+strip). Coverage ~100% –¥–ª—è models.py –≤–∞–ª–∏–¥–∞—Ü–∏–∏."
        rationale: "–í–∞–ª–∏–¥–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–æ–≤ - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–∫–ª–æ–Ω—è—Ç—å—Å—è –Ω–∞ –≤—Ö–æ–¥–µ"

      - target_component: "CalculationMeta, RateUsage, WarningItem"
        test_file: "tests/unit/test_models_meta.py"
        test_functions: ["TestWarningItem (3 tests)", "TestRateUsage (5 tests)", "TestCalculationMeta (21 tests)"]
        coverage_status: "exists"
        priority: "HIGH"
        notes: "30 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç: WarningItem (code, message), RateUsage (base_rate, effective_rate, bank_commission_percent, display), CalculationMeta (age_category, engine_power_hp‚Üíkw –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è 0.7355, rates_used dict, detailed_rates_used dict, customs_value_eur, duty_percent, duty_rate_eur_per_cc, utilization_coefficient, vehicle_type, warnings). –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞: kW = hp √ó 0.7355. Coverage ~95% –¥–ª—è –º–µ—Ç–∞-–º–æ–¥–µ–ª–µ–π."
        rationale: "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI"

      - target_component: "CostBreakdown, CalculationResult"
        test_file: "tests/unit/test_models_breakdown.py"
        test_functions: ["TestCostBreakdown (8 tests)", "TestCalculationResult (7 tests)"]
        coverage_status: "exists"
        priority: "HIGH"
        notes: "17 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç: CostBreakdown (–≤—Å–µ 9 –ø–æ–ª–µ–π - purchase_price_rub, duties_rub, utilization_fee_rub, customs_services_rub, era_glonass_rub, freight_rub, country_expenses_rub, company_commission_rub, total_rub), –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (total = —Å—É–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤), CalculationResult (–∫–æ–º–ø–æ–∑–∏—Ü–∏—è request+meta+breakdown, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö). Coverage ~100% –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞."
        rationale: "CostBreakdown - –æ—Å–Ω–æ–≤–Ω–æ–π –≤—ã—Ö–æ–¥ API, –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –¥–æ–≤–µ—Ä–∏—è –∫ —Ä–∞—Å—á—ë—Ç–∞–º"

      - target_component: "rounding: round_rub, to_decimal, quantize4, round_rub_map, sum_decimals"
        test_file: "tests/unit/test_rounding.py"
        test_functions: ["TestRoundRub (21 tests)", "TestToDecimal (12 tests)", "TestQuantize4 (18 tests)", "TestSumDecimals (6 tests)"]
        coverage_status: "exists"
        priority: "HIGH"
        notes: "SPRINT TEST-03 COMPLETED (2025-12-16): 69 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è: round_rub (ROUND_HALF_UP –¥–ª—è —Ü–µ–ª—ã—Ö —Ä—É–±–ª–µ–π, –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ 0.5‚Üí1, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞, –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ/–º–∞–ª—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è), to_decimal (int/float/str‚ÜíDecimal, –Ω–∞—É—á–Ω–∞—è –Ω–æ—Ç–∞—Ü–∏—è, InvalidOperation –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π), quantize4 (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 4 –∑–Ω–∞–∫–æ–≤, ROUND_HALF_EVEN - banker's rounding), sum_decimals (—Ç–æ—á–Ω–æ—Å—Ç—å –±–µ–∑ float drift). –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å float, int, str. Coverage ~100%"
        rationale: "–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã (total_rub). –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–æ–≤"

      - target_component: "tariff_tables: get_age_category, get_passing_category, find_duty_rate, find_lt3_value_bracket, format_volume_band"
        test_file: "tests/unit/test_tariff_tables.py"
        test_functions: ["TestGetAgeCategory (15 tests)", "TestGetPassingCategory (3 tests)", "TestFindDutyRate (36 tests)", "TestFindLt3ValueBracket (38 tests)", "TestFormatVolumeBand (7 tests)", "TestEdgeCases (10 tests)", "TestDecimalCompatibility (3 tests)"]
        coverage_status: "exists"
        priority: "HIGH"
        notes: "SPRINT TEST-03 COMPLETED (2025-12-16): 117 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫: get_age_category (–≥—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è 2‚Üílt3, 3‚Üí3_5, 5‚Üí3_5, 6‚Üígt5, –æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–µ –∞–≤—Ç–æ), get_passing_category (3_5='passing', –æ—Å—Ç–∞–ª—å–Ω—ã–µ='non_passing'), find_duty_rate (–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –æ–±—ä—ë–º–∞ –¥–ª—è 3_5/gt5, –≥—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è 1000/1500/1800/2300/3000 cc), find_lt3_value_bracket (–≤—Å–µ 6 –±—Ä—ç–∫–µ—Ç–æ–≤ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏: <8500, 8500-16700, 16700-42300, 42300-84500, 84500-169000, >169000 EUR, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –≥—Ä–∞–Ω–∏—Ü <=, Decimal-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å), format_volume_band (lt3‚Üí'value_brackets', 3_5/gt5 —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ). Edge cases: –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ø—É—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –æ–≥—Ä–æ–º–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. Coverage ~100%"
        rationale: "–ö—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–∞ –ø–æ—à–ª–∏–Ω. –û—à–∏–±–∫–∞ –Ω–∞ 1 –≥–æ–¥ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –±—Ä—ç–∫–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ = –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ—à–ª–∏–Ω—ã (duties_rub –º–æ–∂–µ—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å—Å—è –≤ 2-3 —Ä–∞–∑–∞)"

      - target_component: "engine.py helper functions: _compute_duty, _commission, _select_freight, _japan_country_expenses, _other_country_expenses, _convert, _effective_currency_rate, _get_bank_commission_percent"
        test_file: "tests/unit/test_engine_helpers.py"
        test_functions: ["TestComputeDuty (18 tests)", "TestCommission (4 tests)", "TestSelectFreight (6 tests)", "TestJapanCountryExpenses (6 tests)", "TestOtherCountryExpenses (2 tests)", "TestConvert (6 tests)", "TestEffectiveCurrencyRate (4 tests)", "TestGetBankCommissionPercent (7 tests)"]
        coverage_status: "exists"
        priority: "HIGH"
        notes: "SPRINT TEST-04 COMPLETED (2025-12-16): 63 —Ç–µ—Å—Ç–∞ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ helper-—Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ: _compute_duty (LT3: low/medium/high value brackets, percent vs min logic, boundary values 8500/16700/42300 EUR; 3_5: –≤—Å–µ 6 CC –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ ‚â§1000‚Üí>3000; GT5: –≤—Å–µ 6 –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ GT5 rates > 3_5 rates), _commission (default 1000 USD, UAE=0, Georgia=750, bank commission applied), _select_freight (Japan standard/sanctioned, Korea, UAE open/container, default selection), _japan_country_expenses (3 JPY tiers: ‚â§3M, 3M-6M, >6M —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏), _other_country_expenses (Korea 500 USD, UAE 1000 USD), _convert (–≤—Å–µ –≤–∞–ª—é—Ç—ã USD/EUR/JPY/CNY/AED, with/without bank commission, backwards compatibility), _effective_currency_rate (0%, 2%, 5%, 10%), _get_bank_commission_percent (enabled/disabled, missing section, default percent, invalid values). Mock fixtures –¥–ª—è rates/duties/commissions. Coverage ~100%"
        rationale: "Helper-—Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É —Ä–∞—Å—á—ë—Ç–æ–≤. –ò–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ fixtures (mock configs, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤/API"

      - target_component: "engine.calculate() end-to-end integration"
        test_file: "tests/unit/test_engine_integration.py"
        test_functions: ["TestCalculateEndToEnd (5 tests)", "TestCalculateMetadata (4 tests)", "TestCalculateInvariants (6 tests)", "TestSanctionedStatus (1 test)", "TestEdgeCases (3 tests)"]
        coverage_status: "exists"
        priority: "HIGH"
        notes: "SPRINT TEST-04 COMPLETED (2025-12-16): 22 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞ –¥–ª—è calculate(): End-to-End (Japan LT3, Korea 3_5, UAE GT5 commission=0 invariant, China LT3 high value, Georgia GT5 - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã breakdown –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã), Metadata (age category detection LT3/3_5/GT5, HP‚ÜíkW conversion √ó 0.7355, rates_used —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –≤–∞–ª—é—Ç—ã, detailed_rates_used format 'USD/RUB = base + percent%'), Invariants (total = sum of components –¥–ª—è 5 —Å—Ç—Ä–∞–Ω, UAE commission always 0, non-M1 utilization_fee=0 with warning, all components non-negative), Special Cases (sanctions_unknown warning, minimal/maximal car params, low purchase price). BUG FOUND: ERA-GLONASS –Ω–µ –≤–∫–ª—é—á—ë–Ω –≤ total (45000 RUB –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ breakdown, –Ω–æ –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ total_rub). –¢–µ—Å—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏. Coverage ~100% –¥–ª—è calculate() integration paths"
        rationale: "End-to-end —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö helper-—Ñ—É–Ω–∫—Ü–∏–π –≤ –µ–¥–∏–Ω—ã–π —Ä–∞—Å—á—ë—Ç. –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (total=sum, UAE=0) –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –¥–æ–≤–µ—Ä–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ. –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–π bug ERA-GLONASS —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º —Å–ø—Ä–∏–Ω—Ç–µ"

      # MEDIUM PRIORITY (Important - –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)

      - target_component: "_commission with per-country override"
        test_file: "tests/unit/test_commission.py"
        test_functions: []
        coverage_status: "needed"
        priority: "MEDIUM"
        recommendation: "SPRINT TEST-04: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è _commission() - fallback –Ω–∞ global default_commission_usd vs by_country.uae.commission_usd=0"
        rationale: "–õ–æ–≥–∏–∫–∞ fallback –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞. –û–ê–≠ = 0 USD - –≤–∞–∂–Ω—ã–π edge case"

      - target_component: "_select_freight"
        test_file: "tests/unit/test_freight.py"
        test_functions: []
        coverage_status: "needed"
        priority: "MEDIUM"
        recommendation: "SPRINT TEST-04: –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Ñ—Ä–∞—Ö—Ç–∞ - japan (standard/sanctions), uae (open/container), korea (default)"
        rationale: "–°–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–π —Ñ—Ä–∞—Ö—Ç 2000 vs 350 USD, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 3800 vs 2500 USD - –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞"

      - target_component: "_utilization_fee_v2: fallback gt3 –¥–ª—è gt5"
        test_file: "tests/unit/test_utilization_v2.py"
        test_functions: []
        coverage_status: "needed"
        priority: "MEDIUM"
        recommendation: "SPRINT TEST-04: –î–æ–ø–æ–ª–Ω–∏—Ç—å test_utilization_v2.py - —Ç–µ—Å—Ç –¥–ª—è fallback ge3 (gt3) –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ gt5 –≤ —Ç–∞–±–ª–∏—Ü–µ"
        rationale: "–õ–æ–≥–∏–∫–∞ fallback —É–ø–æ–º—è–Ω—É—Ç–∞ –≤ rpg.yaml, –Ω–æ –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏. –ö—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∞–≤—Ç–æ (>5 –ª–µ—Ç)"

      - target_component: "POST /api/rates/refresh"
        test_file: "tests/functional/test_api.py"
        test_functions: []
        coverage_status: "needed"
        priority: "MEDIUM"
        recommendation: "SPRINT TEST-05: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è CBR –∫—ç—à–∞ - POST /api/rates/refresh?force=true"
        rationale: "–≠–Ω–¥–ø–æ–∏–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏. –í–∞–∂–µ–Ω –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏"

      - target_component: "cases.yml: georgia, uae container, japan sanctions"
        test_file: "tests/test_data/cases.yml"
        test_functions: []
        coverage_status: "needed"
        priority: "MEDIUM"
        recommendation: "SPRINT TEST-06: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–µ–π—Å—ã - georgia (freight $750, customs_services 120000), uae freight_type=container (3800 USD), japan sanctions_unknown=True (2000 USD)"
        rationale: "–ì—Ä—É–∑–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ cases.yml, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞, —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–π —Ñ—Ä–∞—Ö—Ç –Ω–µ –ø–æ–∫—Ä—ã—Ç"

      - target_component: "CalculationRequest.normalize_currency"
        test_file: "tests/unit/test_models_validation.py"
        test_functions: []
        coverage_status: "needed"
        priority: "MEDIUM"
        recommendation: "SPRINT TEST-02: –Ø–≤–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è normalize_currency() - 'usd'‚Üí'USD', ' eur '‚Üí'EUR'"
        rationale: "–ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –Ω–æ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ –∫–æ—Å–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ API)"

      # LOW PRIORITY (Additional - —É–ª—É—á—à–∞—é—Ç –æ—Ç–ª–∞–¥–∫—É –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å)
      - target_component: "tariff_tables: get_passing_category"
        test_file: "tests/unit/test_tariff_tables.py"
        test_functions: []
        coverage_status: "needed"
        priority: "LOW"
        recommendation: "SPRINT TEST-03: –¢–µ—Å—Ç –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ 'passing' vs 'non_passing' - lt3‚Üínon_passing, 3_5‚Üípassing, gt5‚Üínon_passing"
        rationale: "–ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á—ë—Ç—ã"

      - target_component: "rates_conf[era_glonass_rub]"
        test_file: "tests/unit/test_config_reading.py"
        test_functions: []
        coverage_status: "needed"
        priority: "LOW"
        recommendation: "SPRINT TEST-07: –¢–µ—Å—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ - rates_conf.get('era_glonass_rub', 45000)"
        rationale: "–ü—Ä–æ—Å—Ç–æ–µ —á—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞. –ü–æ–∫—Ä—ã—Ç–æ –∫–æ—Å–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ test_engine.py"

      - target_component: "rate_limit_middleware"
        test_file: "tests/unit/test_middleware.py"
        test_functions: []
        coverage_status: "needed"
        priority: "LOW"
        recommendation: "SPRINT TEST-07: –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è middleware - <100 req/min ‚Üí 200 OK, >100 ‚Üí 429, cleanup —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π"
        rationale: "–í–∞–∂–Ω–æ –¥–ª—è production, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–æ–≤. –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (mock –≤—Ä–µ–º–µ–Ω–∏)"

    integration_tests:
      # ===== EXISTING TESTS =====
      - integration_point: "API -> Calculation Engine"
        test_description: "POST /api/calculate –¥–ª—è –Ω–∞–±–æ—Ä–∞ –∫–µ–π—Å–æ–≤ (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å—É–º–º –∏ –≤–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è)"
        test_file: "tests/functional/test_engine.py"
        test_functions: ["test_calculation_cases (1 parametrized test with 13 cases from cases.yml)"]
        coverage_status: "exists"
        notes: "–ü–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (lt3, 3_5, gt5), —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã (japan, korea, china), engine_power_hp, –ª–æ–≥–∏–∫—É min(percent, min_rate_eur_per_cc)"

      - integration_point: "API -> Configs (rates/fees/commissions/duties)"
        test_description: "GET /api/rates, /api/meta, /api/health - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤"
        test_file: "tests/functional/test_api.py"
        test_functions: ["TestRatesEndpoint (11 tests)", "TestMetaEndpoint (10 tests)", "TestHealthEndpoint (2 tests)", "TestRatesRefreshEndpoint (2 tests)", "TestCalculateSuccessfulCases (5 tests)", "TestCalculateInvariants (4 tests)"]
        coverage_status: "exists"
        test_priority: "high"
        notes: "SPRINT TEST-05 ‚úÖ: Comprehensive API coverage - structure validation, all 5 currencies, all 5 countries, invariants (total=sum, UAE commission=0), engine_power conversion, detailed_rates_used structure"

      - integration_point: "API -> Input Validation"
        test_description: "POST /api/calculate - –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏"
        test_file: "tests/functional/test_api_validation.py"
        test_functions: ["TestCalculateValidation (22 tests)", "TestCalculateBoundaryValues (29 tests)"]
        coverage_status: "exists"
        test_priority: "high"
        notes: "SPRINT TEST-05 ‚úÖ: Comprehensive validation testing - missing fields (422), year bounds (1990-current), engine_cc (1-10000), engine_power_hp (1-1500), purchase_price > 0, unsupported currencies/countries/freight_types, ValidationError structure, all boundary values, age category boundaries"

      - integration_point: "API -> Bank Commission"
        test_description: "–í–ª–∏—è–Ω–∏–µ bank_commission.percent –Ω–∞ total_rub –∏ display –∫—É—Ä—Å–æ–≤"
        test_file: "tests/functional/test_api_bank_commission.py"
        test_functions: ["test_api_calculate_without_bank_commission_baseline", "test_api_calculate_with_bank_commission_increases_total", "test_api_meta_rates_used_structure"]
        coverage_status: "exists"
        notes: "SPRINT 4.5-4.7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç–∏ total_rub, —Ñ–æ—Ä–º–∞—Ç–∞ detailed_rates_used.display ('+X%'), –±–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏"

      - integration_point: "Services -> CBR API"
        test_description: "–ü–∞—Ä—Å–∏–Ω–≥ CBR XML –∏ —Å–ª–∏—è–Ω–∏–µ —Å –±–∞–∑–æ–≤—ã–º–∏ –∫—É—Ä—Å–∞–º–∏"
        test_file: "tests/functional/test_cbr.py"
        test_functions: ["test_parse_cbr_xml_basic", "test_get_effective_rates_monkeypatch"]
        coverage_status: "exists"
        notes: "–ü–æ–∫—Ä—ã–≤–∞–µ—Ç parse_cbr_xml (5 –≤–∞–ª—é—Ç), get_effective_rates —Å monkeypatch fake_fetch"

      # ===== GAPS IDENTIFIED (TEST AUDIT 2025-12-16) =====
      - integration_point: "API -> CBR Service (refresh)"
        test_description: "POST /api/rates/refresh —Ñ–æ—Ä—Å–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ CBR"
        test_file: "tests/functional/test_api.py"
        test_functions: ["TestRatesRefreshEndpoint::test_refresh_rates_success", "TestRatesRefreshEndpoint::test_refresh_rates_structure"]
        coverage_status: "exists"
        priority: "MEDIUM"
        notes: "SPRINT TEST-05 ‚úÖ: Gap CLOSED - POST /api/rates/refresh covered with structure validation"

      - integration_point: "Bot -> Engine"
        test_description: "–•–µ–Ω–¥–ª–µ—Ä—ã /calc –∏ web_app_data –≤—ã–∑—ã–≤–∞—é—Ç calculate –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
        test_file: "tests/manual/test_bot_handlers_sprint7.py"
        test_functions: ["Manual tests only"]
        coverage_status: "manual_only"
        priority: "LOW"
        notes: "–†—É—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤ tests/manual/. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è (—Ç—Ä–µ–±—É–µ—Ç Telegram Bot API mock)"

      - integration_point: "App Static -> WebApp"
        test_description: "–†–∞–∑–¥–∞—á–∞ /web/, /manifest.json, /sw.js"
        test_file: "-"
        coverage_status: "needed"
        priority: "LOW"
        recommendation: "SPRINT TEST-07: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ - GET /web/index.html ‚Üí 200, GET /manifest.json ‚Üí 200, Content-Type –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π"

  edges:
    inter_module_flows:
      - from: "app_core"
        to: "app_calculation"
        data_type: "ConfigRegistry (rates, duties, fees, commissions)"
        description: "engine.calculate –∏—Å–ø–æ–ª—å–∑—É–µ—Ç get_configs() –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤"
      - from: "app_services"
        to: "app_calculation"
        data_type: "dict (currencies merged, live_source)"
        description: "get_effective_rates –ø–æ–¥–º–µ—à–∏–≤–∞–µ—Ç live-–∫—É—Ä—Å—ã –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π"
      - from: "app_api"
        to: "app_calculation"
        data_type: "CalculationRequest -> CalculationResult"
        description: "REST —Å–ª–æ–π –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥ –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤ –¥–≤–∏–∂–æ–∫ —Ä–∞—Å—á—ë—Ç–∞"
      - from: "app_main"
        to: "app_api"
        data_type: "APIRouter"
        description: "main.create_app –º–æ–Ω—Ç–∏—Ä—É–µ—Ç router —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º /api"
      - from: "app_bot"
        to: "app_calculation"
        data_type: "CalculationRequest (—Å–æ–±—Ä–∞–Ω–Ω—ã–π –≤ –∫–æ–¥–µ) -> CalculationResult"
        description: "–•–µ–Ω–¥–ª–µ—Ä—ã –±–æ—Ç–∞ –≤—ã–∑—ã–≤–∞—é—Ç calculate –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö WebApp"
      - from: "config_data"
        to: "app_core"
        data_type: "YAML -> dict"
        description: "settings.ConfigRegistry.load –∑–∞–≥—Ä—É–∂–∞–µ—Ç YAML –≤ —Å–ª–æ–≤–∞—Ä–∏"
      - from: "app_services"
        to: "app_core"
        data_type: "settings"
        description: "CBR-—Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AppSettings –¥–ª—è URL, TTL –∏ —Ñ–ª–∞–≥–æ–≤ live"
      - from: "config_data"
        to: "app_calculation"
        data_type: "commissions.yml::bank_commission, rates.yml::currencies"
        description: "–î–≤–∏–∂–æ–∫ —á–∏—Ç–∞–µ—Ç config/commissions.yml::bank_commission (enabled, percent) –∏ config/rates.yml (base_rate), –≤—ã—á–∏—Å–ª—è–µ—Ç effective_rate = base_rate √ó (1 + bank_commission_percent/100) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ RUB. –í JSON-–æ—Ç–≤–µ—Ç–µ /api/calculate –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª–µ–º; –µ—ë —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ breakdown.total_rub –∏ –≤ meta.rates_used/detailed_rates_used.display."
      - from: "app_calculation"
        to: "app_api"
        description: "engine.calculate() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç CalculationResult, –≤–∫–ª—é—á–∞—é—â–∏–π CostBreakdown –∏ CalculationMeta. –í CalculationMeta —Ö—Ä–∞–Ω—è—Ç—Å—è rates_used –∏ detailed_rates_used: –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç–Ω–æ–π –ø–∞—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, USD_RUB) –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è base_rate, bank_commission_percent, effective_rate –∏ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è UI. API –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ —Ç–æ–ª—å–∫–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –∏—Ö –≤ JSON."
      - from: "app_api"
        to: "app_webapp"
        description: "WebApp –≤—ã–∑—ã–≤–∞–µ—Ç POST /api/calculate –∏ –ø–æ–ª—É—á–∞–µ—Ç JSON —Å breakdown, meta –∏ request. –ò–∑ meta.detailed_rates_used WebApp –±–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫—É –∫—É—Ä—Å–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'USD/RUB = 78.95 + 1%') –∏ –Ω–µ –∑–Ω–∞–µ—Ç –Ω–∏—á–µ–≥–æ –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ñ–æ—Ä–º—É–ª–µ effective_rate –∏–ª–∏ —Å—É–º–º–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏. –í breakdown –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π 'bank_commission_*'."
      - from: "app_api"
        to: "app_bot"
        description: "Telegram-–±–æ—Ç (—á–µ—Ä–µ–∑ engine.calculate –∏/–∏–ª–∏ –∫–æ—Å–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ API) –ø–æ–ª—É—á–∞–µ—Ç CalculationResult –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç meta.detailed_rates_used.display –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –∫—É—Ä—Å–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏. –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π, —Ç–æ–ª—å–∫–æ –∫–∞–∫ '+ X%' —Ä—è–¥–æ–º —Å –±–∞–∑–æ–≤—ã–º –∫—É—Ä—Å–æ–º."

    intra_module_dependencies:
      - from: "engine.py"
        to: "models.py"
        dependency_type: "import"
        description: "–¢–∏–ø—ã CalculationRequest/Result, CostBreakdown, Meta"
      - from: "engine.py"
        to: "rounding.py"
        dependency_type: "import"
        description: "–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∏ Decimal-—É—Ç–∏–ª–∏—Ç—ã"
      - from: "engine.py"
        to: "tariff_tables.py"
        dependency_type: "import"
        description: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Å—Ç–∞–≤–æ–∫ –ø–æ—à–ª–∏–Ω—ã"
      - from: "engine.py"
        to: "cbr.py"
        dependency_type: "import"
        description: "get_effective_rates –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç"
      - from: "routes.py"
        to: "engine.py"
        dependency_type: "import"
        description: "–í—ã–∑–æ–≤ calculate() –∏–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞"
      - from: "routes.py"
        to: "settings.py"
        dependency_type: "import"
        description: "–ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤/–Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ /rates, /meta, /health"
      - from: "app/main.py"
        to: "app/api/routes.py"
        dependency_type: "import"
        description: "–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —Ä–æ—É—Ç–µ—Ä–∞"
      - from: "app/bot/handlers/start.py"
        to: "app/bot/keyboards.py"
        dependency_type: "import"
        description: "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è WebApp"
      - from: "app/bot/handlers/start.py"
        to: "engine.py"
        dependency_type: "import"
        description: "–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ WebApp-–¥–∞–Ω–Ω—ã—Ö"

    component_relationships:
      - from: "calculate"
        to: "_compute_duty"
        relationship: "calls"
        description: "–†–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ–±—ä—ë–º—É"
      - from: "calculate"
        to: "_utilization_fee"
        relationship: "calls"
        description: "–ü–æ–¥–±–æ—Ä —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ M1"
      - from: "calculate"
        to: "_commission"
        relationship: "calls"
        description: "–ö–æ–º–∏—Å—Å–∏—è –ø–æ –ø–æ—Ä–æ–≥–∞–º"
      - from: "calculate"
        to: "get_effective_rates"
        relationship: "uses"
        description: "–ü–æ–¥–º–µ—à–∏–≤–∞–Ω–∏–µ live‚Äë–∫—É—Ä—Å–æ–≤ CBR –ø–æ–≤–µ—Ä—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö"
      - from: "_compute_duty"
        to: "find_lt3_value_bracket / find_duty_rate"
        relationship: "uses"
        description: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫ –ø–æ—à–ª–∏–Ω—ã"
      - from: "calculate_endpoint"
        to: "calculate"
        relationship: "calls"
        description: "–ì–ª–∞–≤–Ω—ã–π API-—ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–∞—Å—á—ë—Ç–∞"
      - from: "get_rates / get_meta / health"
        to: "get_configs / get_settings"
        relationship: "uses"
        description: "–ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"
      - from: "get_effective_rates"
        to: "fetch_cbr_rates"
        relationship: "calls"
        description: "–ó–∞–≥—Ä—É–∑–∫–∞ live‚Äë–∫—É—Ä—Å–æ–≤ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ"
      - from: "CBRRatesService._do_fetch"
        to: "httpx.get"
        relationship: "calls"
        description: "–ó–∞–ø—Ä–æ—Å XML CBR –∏ —Ä–∞–∑–±–æ—Ä"
      - from: "create_app"
        to: "api.router"
        relationship: "uses"
        description: "–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
      - from: "rate_limit_middleware"
        to: "JSONResponse"
        relationship: "uses"
        description: "–û—Ç–≤–µ—Ç 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞"
      - from: "cmd_calc / on_webapp_data"
        to: "calculate"
        relationship: "calls"
        description: "–†–∞—Å—á—ë—Ç –ø–æ –∫–æ–º–∞–Ω–¥–µ –±–æ—Ç–∞ –∏ –¥–∞–Ω–Ω—ã–º WebApp"
      - from: "app_calculation"
        to: "app_api"
        description: "engine.calculate() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç CalculationResult, –≤–∫–ª—é—á–∞—é—â–∏–π CostBreakdown –∏ CalculationMeta. –í CalculationMeta —Ö—Ä–∞–Ω–∏—Ç—Å—è rates_used: –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç–Ω–æ–π –ø–∞—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, USD_RUB) –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è base_rate, bank_commission_percent, effective_rate –∏ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è UI –≤–∏–¥–∞ 'BASE_RATE [+ X%]'. API –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –ª–∏—à—å —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –∏—Ö –≤ JSON."
      - from: "app_api"
        to: "app_webapp"
        description: "WebApp –≤—ã–∑—ã–≤–∞–µ—Ç POST /api/calculate –∏ –ø–æ–ª—É—á–∞–µ—Ç JSON —Å breakdown, meta –∏ request. –ò–∑ meta.rates_used WebApp –±–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫—É –∫—É—Ä—Å–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'USD/RUB = 78.95 + 1%') –∏ –Ω–µ –∑–Ω–∞–µ—Ç –Ω–∏—á–µ–≥–æ –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ñ–æ—Ä–º—É–ª–µ effective_rate –∏–ª–∏ —Å—É–º–º–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏. –í breakdown –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π 'bank_commission_*'."
      - from: "app_api"
        to: "app_bot"
        description: "Telegram-–±–æ—Ç (—á–µ—Ä–µ–∑ engine.calculate –∏–ª–∏ –∫–æ—Å–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ API) –ø–æ–ª—É—á–∞–µ—Ç CalculationResult –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç meta.rates_used –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –∫—É—Ä—Å–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ (–∞–Ω–∞–ª–æ–≥ WebApp). –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π, —Ç–æ–ª—å–∫–æ –∫–∞–∫ '+ X%' —Ä—è–¥–æ–º —Å –±–∞–∑–æ–≤—ã–º –∫—É—Ä—Å–æ–º."
      - from: "config_data"
        to: "app_calculation"
        description: "–î–≤–∏–∂–æ–∫ —á–∏—Ç–∞–µ—Ç config/commissions.yml::bank_commission (enabled, percent) –∏ config/rates.yml (base_rate), –≤—ã—á–∏—Å–ª—è–µ—Ç effective_rate = base_rate √ó (1 + bank_commission_percent/100) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ RUB. –ü—Ä–∏ —ç—Ç–æ–º –≤ JSON-–æ—Ç–≤–µ—Ç–µ /api/calculate –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª–µ–º; –µ—ë —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ breakdown.total_rub –∏ –≤ meta.rates_used/detailed_rates_used.display."
      - from: "app_calculation"
        to: "app_webapp"
        description: "–ß–µ—Ä–µ–∑ API –¥–≤–∏–∂–æ–∫ –ø–µ—Ä–µ–¥–∞—ë—Ç WebApp CalculationResult; WebApp –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ meta.rates_used –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—É—Ä—Å–∞ 'BASE_RATE [+ PERCENT%]' –∏ –Ω–∞ breakdown –¥–ª—è —Å—É–º–º –≤ —Ä—É–±–ª—è—Ö."
      - from: "app_calculation"
        to: "app_bot"
        description: "–ß–µ—Ä–µ–∑ API –∏/–∏–ª–∏ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –¥–≤–∏–∂–∫–∞ –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç CalculationResult –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∏—Å–ø–æ–ª—å–∑—É—è breakdown.total_rub –∏ meta.rates_used. –ö–æ–º–∏—Å—Å–∏—è –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–∞–∫ –Ω–∞–¥–±–∞–≤–∫–∞ –∫ –∫—É—Ä—Å—É, –∞ –Ω–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏."

  sprints:
    config_management:
      description: "–°–µ—Ä–∏—è –∏–∑ 6 —Å–ø—Ä–∏–Ω—Ç–æ–≤ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ YAML-—Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç"
      total_time: "16 hours"
      methodology: "RPG (Role-Playing Graph)"
      created_date: "2025-12-28"
      status: "READY_FOR_IMPLEMENTATION"
      documentation: "sprints/README.md"

      phases:
        - id: "CONFIG-01"
          name: "Module Scaffolding"
          file: "sprints/SPRINT_CONFIG_01_module_scaffolding.md"
          duration: "2h"
          dependencies: []
          status: "PENDING"
          role: "Senior Backend Python Developer"
          goals:
            - "–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å app/bot/handlers/config.py —Å –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π"
            - "–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å ConfigFile enum –∏ CONFIG_METADATA"
            - "–°–æ–∑–¥–∞—Ç—å FSM States –¥–ª—è –≤—Å–µ—Ö 4 —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ñ–∏–≥–æ–≤"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å helper-—Ñ—É–Ω–∫—Ü–∏–∏ get_config_path(), get_backup_path()"
          deliverables:
            - "app/bot/handlers/config.py (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è)"
            - "tests/unit/test_config_handlers.py (unit-—Ç–µ—Å—Ç—ã)"
          documentation_updates:
            - "docs/rpg.yaml (–Ω–æ–≤–∞—è —Å–µ–∫—Ü–∏—è app_bot_config)"
            - "CHANGELOG.md (SPRINT CONFIG-01)"
            - "README.md (Config Management —Å–µ–∫—Ü–∏—è)"

        - id: "CONFIG-02"
          name: "Download Commands Implementation"
          file: "sprints/SPRINT_CONFIG_02_download_commands.md"
          duration: "2h"
          dependencies: ["CONFIG-01"]
          status: "COMPLETED"
          completed_date: "2025-12-28"
          role: "Senior Python Developer (aiogram 3.x expert)"
          goals:
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã /get_fees, /get_commissions, /get_rates, /get_duties"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /list_configs"
            - "–î–æ–±–∞–≤–∏—Ç—å error handling –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤"
            - "–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ caption'—ã —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ä–∞–∑–º–µ—Ä–æ–º"
          deliverables:
            - "app/bot/handlers/config.py (5 –∫–æ–º–∞–Ω–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)"
            - "tests/unit/test_config_download.py (integration —Ç–µ—Å—Ç—ã, 92% coverage)"
          documentation_updates:
            - "docs/rpg.yaml (features: download commands, status COMPLETED)"
            - "CHANGELOG.md (SPRINT CONFIG-02)"
            - "README.md (Config Management Commands section)"
          features:
            - "–ö–æ–º–∞–Ω–¥—ã —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: /get_fees, /get_commissions, /get_rates, /get_duties"
            - "–ö–æ–º–∞–Ω–¥–∞ /list_configs –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º"
            - "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ caption —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ä–∞–∑–º–µ—Ä–æ–º —Ñ–∞–π–ª–∞"
            - "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ (404)"
            - "Generic —Ñ—É–Ω–∫—Ü–∏—è send_config_file() –¥–ª—è DRY"
            - "–§—É–Ω–∫—Ü–∏—è format_config_list() –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞"
          testing:
            - "11 —Ç–µ—Å—Ç–æ–≤: 3 –¥–ª—è send_config_file(), 3 –¥–ª—è format_config_list(), 5 –¥–ª—è –∫–æ–º–∞–Ω–¥"
            - "92% coverage (–ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ü–µ–ª—å 90%)"
            - "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è anyio —Å asyncio backend"
            - "–ú–æ–∫–∏ aiogram Message, FSInputFile"

        - id: "CONFIG-03"
          name: "Upload Commands with FSM and Race Condition Protection"
          file: "sprints/SPRINT_CONFIG_03_upload_commands.md"
          duration: "3h"
          dependencies: ["CONFIG-01", "CONFIG-02"]
          status: "COMPLETED"
          completed_date: "2025-12-28"
          role: "Senior Python Developer (FSM, YAML validation & concurrency expert)"
          goals:
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã /set_fees, /set_commissions, /set_rates, /set_duties —Å FSM"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /cancel –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏"
            - "–î–æ–±–∞–≤–∏—Ç—å 4-level validation (filename, size, YAML syntax, structure)"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup —Å timestamp"
            - "–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ (shutil.move)"
            - "–ó–∞—â–∏—Ç–∞ –æ—Ç race conditions —Å asyncio.Lock"
          deliverables:
            - "app/bot/handlers/config.py (4 –∫–æ–º–∞–Ω–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ + /cancel, concurrency locks)"
            - "tests/unit/test_config_upload.py (24 —Ç–µ—Å—Ç–∞, –≤–∫–ª—é—á–∞—è concurrency)"
            - "docs/CONFIG_CONCURRENCY.md (–∞–Ω–∞–ª–∏–∑ race conditions –∏ —Ä–µ—à–µ–Ω–∏–µ)"
          documentation_updates:
            - "docs/rpg.yaml (features: upload with FSM + race protection)"
            - "CHANGELOG.md (SPRINT CONFIG-03)"
            - "docs/CONFIG_CONCURRENCY.md (Race condition analysis & asyncio.Lock solution)"
          features:
            - "–ö–æ–º–∞–Ω–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏: /set_fees, /set_commissions, /set_rates, /set_duties —Å FSM"
            - "–ö–æ–º–∞–Ω–¥–∞ /cancel –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏"
            - "4-level validation: filename (path traversal –∑–∞—â–∏—Ç–∞), size (1MB), YAML syntax (safe_load), structure (required_keys)"
            - "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup: {filename}.backup.YYYYMMDD_HHMMSS (UTC)"
            - "–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞: shutil.move() –¥–ª—è thread-safety"
            - "Race condition protection: asyncio.Lock per config type"
            - "–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–±–µ–∑ lock) + serial critical section (—Å lock)"
            - "–†–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ locks)"
          concurrency:
            - "asyncio.Lock per ConfigFile (fees/commissions/rates/duties)"
            - "_get_config_lock() –¥–ª—è lazy initialization"
            - "Lock —Ç–æ–ª—å–∫–æ –Ω–∞ backup + replace (~0.2s overhead)"
            - "Validation –±–µ–∑ lock (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏)"
          testing:
            - "24 —Ç–µ—Å—Ç–∞: validation (8), backup (3), commands (6), download (5), concurrency (5)"
            - "Coverage ‚â• 90%"
            - "Concurrency tests: serialization (same config), parallelism (different configs)"
          security:
            - "Filename validation (no path traversal)"
            - "Max file size: 1MB"
            - "yaml.safe_load (no code injection)"
            - "Temporary files cleanup on errors"

        - id: "CONFIG-04"
          name: "Admin Access Control"
          file: "sprints/SPRINT_CONFIG_04_admin_middleware.md"
          duration: "2h"
          dependencies: ["CONFIG-01", "CONFIG-02", "CONFIG-03"]
          status: "PENDING"
          role: "Senior Security Engineer (aiogram middleware expert)"
          goals:
            - "–°–æ–∑–¥–∞—Ç—å AdminOnlyMiddleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"
            - "–†–∞—Å—à–∏—Ä–∏—Ç—å AppSettings –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ADMIN_USER_IDS"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /whoami –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è user ID"
            - "–î–æ–±–∞–≤–∏—Ç—å audit logging (unauthorized_access_attempt, admin_command_executed)"
            - "–ü—Ä–∏–º–µ–Ω–∏—Ç—å middleware –∫ config router"
          deliverables:
            - "app/bot/middlewares/admin_check.py (AdminOnlyMiddleware)"
            - "app/core/settings.py (ADMIN_USER_IDS)"
            - ".env.example (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ admin setup)"
            - "tests/unit/test_admin_middleware.py (unit-—Ç–µ—Å—Ç—ã)"
          documentation_updates:
            - "docs/rpg.yaml (–Ω–æ–≤–∞—è —Å–µ–∫—Ü–∏—è app_bot_middlewares)"
            - "CHANGELOG.md (SPRINT CONFIG-04)"
            - "README.md (Admin Access Control)"
            - "docs/CONFIG_MANAGEMENT.md (Access Control)"

        - id: "CONFIG-05"
          name: "Hot Reload Implementation"
          file: "sprints/SPRINT_CONFIG_05_hot_reload.md"
          duration: "3h"
          dependencies: ["CONFIG-01", "CONFIG-02", "CONFIG-03", "CONFIG-04"]
          status: "PENDING"
          role: "Senior Backend Developer (runtime config management expert)"
          goals:
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /reload_configs –¥–ª—è hot reload"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /config_status –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–∏"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /config_diff –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –¥–∏—Å–∫–∞"
            - "–î–æ–±–∞–≤–∏—Ç—å config versioning (hash + timestamp)"
            - "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å graceful error handling —Å rollback"
            - "–î–æ–±–∞–≤–∏—Ç—å performance metrics (load_time_ms)"
          deliverables:
            - "app/core/settings.py (reload_configs() function)"
            - "app/bot/handlers/config.py (3 –∫–æ–º–∞–Ω–¥—ã: reload, status, diff)"
            - "tests/unit/test_config_reload.py (unit-—Ç–µ—Å—Ç—ã)"
          documentation_updates:
            - "docs/rpg.yaml (features: hot reload)"
            - "CHANGELOG.md (SPRINT CONFIG-05)"
            - "README.md (Hot Reload feature)"
            - "docs/CONFIG_MANAGEMENT.md (Hot Reload workflow)"

        - id: "CONFIG-06"
          name: "Integration & Documentation"
          file: "sprints/SPRINT_CONFIG_06_integration_docs.md"
          duration: "4h"
          dependencies: ["CONFIG-01", "CONFIG-02", "CONFIG-03", "CONFIG-04", "CONFIG-05"]
          status: "PENDING"
          role: "DevOps Engineer & Technical Writer"
          goals:
            - "–§–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ app/bot/main.py"
            - "–°–æ–∑–¥–∞—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ workflow"
            - "–ù–∞–ø–∏—Å–∞—Ç—å CONFIG_ADMIN_GUIDE.md (user guide)"
            - "–ù–∞–ø–∏—Å–∞—Ç—å CONFIG_INCIDENT_PLAYBOOK.md (ops guide)"
            - "–û–±–Ω–æ–≤–∏—Ç—å docker-compose.yml –∏ .env.example"
            - "–î–æ–±–∞–≤–∏—Ç—å health check endpoint"
            - "–§–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
          deliverables:
            - "app/bot/main.py (–ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)"
            - "tests/functional/test_config_management_e2e.py (E2E —Ç–µ—Å—Ç—ã)"
            - "docs/CONFIG_ADMIN_GUIDE.md (complete user guide)"
            - "docs/CONFIG_INCIDENT_PLAYBOOK.md (ops playbook)"
            - "docker-compose.yml (health checks)"
            - ".env.example (full documentation)"
          documentation_updates:
            - "docs/rpg.yaml (status: PRODUCTION_READY)"
            - "CHANGELOG.md (v2.1.0 release notes)"
            - "README.md (complete feature list)"
            - "docs/CONFIG_MANAGEMENT.md (finalize)"

      features:
        download:
          - "/get_fees - Download fees.yml"
          - "/get_commissions - Download commissions.yml"
          - "/get_rates - Download rates.yml"
          - "/get_duties - Download duties.yml"
          - "/list_configs - List all available configs"

        upload:
          - "/set_fees - Upload new fees.yml with FSM"
          - "/set_commissions - Upload new commissions.yml with FSM"
          - "/set_rates - Upload new rates.yml with FSM"
          - "/set_duties - Upload new duties.yml with FSM"
          - "/cancel - Cancel current upload operation"

        reload:
          - "/reload_configs - Hot reload without restart (zero downtime)"
          - "/config_status - Check current version (hash + timestamp)"
          - "/config_diff - Compare memory vs disk"

        utility:
          - "/whoami - Get your Telegram user ID"

      security:
        - "AdminOnlyMiddleware - Whitelist-based access control"
        - "ADMIN_USER_IDS - Comma-separated list of admin user IDs"
        - "4-level validation: filename, size (‚â§1MB), YAML syntax, structure"
        - "Audit logging: all admin actions + unauthorized attempts"
        - "Automatic backups with timestamp before replacement"
        - "Graceful error handling with rollback"

      technical_details:
        module: "app/bot/handlers/config.py"
        lines_of_code: "~850 LOC"
        test_coverage: "‚â•90%"
        dependencies:
          - "aiogram 3.x (Bot, Dispatcher, Router, FSM)"
          - "PyYAML (safe_load for parsing)"
          - "structlog (logging)"
          - "pathlib (file operations)"
          - "hashlib (config versioning)"

        config_files:
          - name: "fees.yml"
            required_keys: ["countries", "freight"]
            description: "–¢–∞—Ä–∏—Ñ—ã —Å—Ç—Ä–∞–Ω –∏ —Ñ—Ä–∞—Ö—Ç–∞"
          - name: "commissions.yml"
            required_keys: ["company_commission", "bank_commission"]
            description: "–ö–æ–º–∏—Å—Å–∏–∏ (–≤–∫–ª—é—á–∞—è bank_commission)"
          - name: "rates.yml"
            required_keys: ["rates", "utilization"]
            description: "–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –∏ —É—Ç–∏–ª—å—Å–±–æ—Ä"
          - name: "duties.yml"
            required_keys: ["petrol", "electric"]
            description: "–¢–∞–±–ª–∏—Ü—ã –ø–æ—à–ª–∏–Ω"

      testing:
        unit_tests: "tests/unit/test_config_*.py"
        integration_tests: "tests/unit/test_config_download.py, test_config_upload.py"
        e2e_tests: "tests/functional/test_config_management_e2e.py"
        coverage_target: "‚â•90%"
        test_scenarios:
          - "Download config (success, file not found)"
          - "Upload config (success, validation failed, wrong filename, too large)"
          - "Reload config (success, failure with rollback, hash change detection)"
          - "Access control (admin granted, non-admin denied)"
          - "FSM workflow (start, upload, cancel)"
          - "Config diff (in sync, out of sync)"

      deployment:
        requirements:
          - "BOT_TOKEN environment variable (required)"
          - "ADMIN_USER_IDS environment variable (optional, comma-separated)"
          - "config/ directory mounted in Docker"
          - "logs/ directory for audit trail"

        docker_compose:
          - "Health check endpoint"
          - "Volume mounts for config/ and logs/"
          - "Environment variables from .env"

        monitoring:
          - "Health check: /health endpoint"
          - "Logs: structured JSON with structlog"
          - "Metrics: load_time_ms, hash_changed"
          - "Alerts: config_reload_failed, unauthorized_access_attempt"

      documentation:
        user_guide: "docs/CONFIG_ADMIN_GUIDE.md"
        ops_guide: "docs/CONFIG_INCIDENT_PLAYBOOK.md"
        tech_overview: "docs/CONFIG_MANAGEMENT.md"
        sprint_prompts: "sprints/SPRINT_CONFIG_*.md"
        readme: "sprints/README.md"
